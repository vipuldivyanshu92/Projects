<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from pylonsbook.com/en/1.0/css-javascript-and-ajax.html by HTTrack Website Copier/3.x [XR&CO'2008], Thu, 11 Jun 2009 15:43:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Chapter 15: CSS, JavaScript, and Ajax &mdash; Pylons Book v1.0 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Pylons Book v1.0 documentation" href="index.html" />
    <link rel="next" title="Chapter 16: The Web Server Gateway Interface (WSGI)" href="the-web-server-gateway-interface-wsgi.html" />
    <link rel="prev" title="Chapter 14: SimpleSite Tutorial Part 2" href="simplesite-tutorial-part-2.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="the-web-server-gateway-interface-wsgi.html" title="Chapter 16: The Web Server Gateway Interface (WSGI)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="simplesite-tutorial-part-2.html" title="Chapter 14: SimpleSite Tutorial Part 2"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Pylons Book v1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="chapter-15-css-javascript-and-ajax">
<h1>Chapter 15: CSS, JavaScript, and Ajax<a class="headerlink" href="#chapter-15-css-javascript-and-ajax" title="Permalink to this headline">¶</a></h1>
<p id="index-59">One of the definitive technologies of Web 2.0 is Ajax, which means Asynchronous JavaScript and XML and allows the browser to communicate with a server without needing to refresh the page the user is viewing. Interestingly, Ajax doesn’t necessarily need to use JavaScript or XML, so it is only the <em>Asynchronous</em> part of the name that is the truly important aspect of the technology.</p>
<p id="index-60">The world of JavaScript web frameworks is changing as fast now as the world of Python web frameworks was five years ago. Early versions of Pylons officially supported the Prototype and Script.aculo.us libraries used by Ruby on Rails, but despite this, Pylons users actually used a range of JavaScript frameworks. Two things quickly became apparent:</p>
<blockquote>
<ul class="simple">
<li>Pylons users choose whichever framework best provides the tools they need, rather than going with the official library.</li>
<li>JavaScript frameworks for the most part actually operate quite independently from the web framework that is using them. After all, one set of code runs on the server, and the other runs on the client.</li>
</ul>
</blockquote>
<p>The latest versions of Pylons (and in particular, WebHelpers) do not integrate any JavaScript framework, and as a result, you are free to choose whichever framework you prefer.</p>
<p id="index-61">At the time of writing, the following three JavaScript frameworks are the most popular with Pylons developers:</p>
<blockquote>
<ul class="simple">
<li>JQuery</li>
<li>YUI</li>
<li>ExtJS</li>
</ul>
</blockquote>
<p>One of the main benefits of YUI is that it is more than just a JavaScript framework. It also has tools for managing CSS and for creating user interfaces.</p>
<div class="section" id="adding-yui-to-your-project">
<h2>Adding YUI to Your Project<a class="headerlink" href="#adding-yui-to-your-project" title="Permalink to this headline">¶</a></h2>
<p id="index-62">You can use YUI in your project in two ways; the first is to copy the YUI library to your project’s <tt class="docutils literal"><span class="pre">public</span></tt> directory and have Pylons serve the files, and the second is to use the files that Yahoo serves directly from its content delivery network (CDN).</p>
<p>Because Yahoo has servers all over the world, it is more likely that it will have a server physically near the person using your application, which should mean that users a long way from the server serving your Pylons application might get a small performance improvement.</p>
<p id="index-63">I don’t know about you, but when I’m responsible for a web site, I like to be in control of as many of the dependencies as possible; therefore, despite the possible benefits, I recommend installing YUI into your <tt class="docutils literal"><span class="pre">public</span></tt> directory. That way, if someone should trip over a wire and disconnect a server at Yahoo, your application won’t be affected.</p>
<p id="index-64">You can download the latest version of YUI from <a class="reference external" href="http://developer.yahoo.com/yui/download/">http://developer.yahoo.com/yui/download/</a>. This book describes version 2.6.0.</p>
<p>To add YUI to a Pylons project, unzip the download into the project’s <tt class="docutils literal"><span class="pre">public</span></tt> directory:</p>
<div class="highlight-python"><pre>$ cd public
$ unzip yui_2.6.0.zip</pre>
</div>
<p>You need to serve files from the <tt class="docutils literal"><span class="pre">build</span></tt> directory only, although the other folders contain useful documentation and examples you might want to browse. Remove the files you don’t need with this:</p>
<div class="highlight-python"><pre>$ cd yui
$ rm -r as-docs as-src assets docs examples tests index.html README</pre>
</div>
<p>I usually also rename the <tt class="docutils literal"><span class="pre">build</span></tt> directory with the version number of the YUI library I’m using so that I can later use a different version alongside the current one:</p>
<div class="highlight-python"><pre>$ mv build 2.6.0</pre>
</div>
<p id="index-65">The examples in this chapter will assume you have set up YUI in this way.</p>
</div>
<div class="section" id="resetting-the-browser-css">
<h2>Resetting the Browser CSS<a class="headerlink" href="#resetting-the-browser-css" title="Permalink to this headline">¶</a></h2>
<p id="index-66">Anyone who has ever created a web site for one browser only to find that it looks completely different on another will understand this problem: different browsers interpret the same CSS in different ways. Fixing the broken style on one browser then makes it look different in the first, and before long you are tearing your hair out.</p>
<p>YUI has a fairly effective solution to this problem: reset browser styles across all browsers before you start coding your CSS; then, since the styles you add don’t rely on the styles the browser implementation has decided to add by default, your styles stand a much greater chance of being consistent across different browsers.</p>
<p>You can add the YUI <tt class="docutils literal"><span class="pre">reset.css</span></tt> style sheet by adding the following lines to the <tt class="docutils literal"><span class="pre">&lt;head&gt;</span></tt> section of your HTML page:</p>
<div class="highlight-python"><pre>&lt;link rel="stylesheet" type="text/css" href="/yui/2.6.0/reset/reset-min.css"&gt;</pre>
</div>
<p>To add the style sheet to a Pylons application with the YUI files in the <tt class="docutils literal"><span class="pre">public</span></tt> directory as you added earlier, you would use this in the head of your HTML in your base template:</p>
<div class="highlight-python"><pre>${h.stylesheet_link(h.url_for('/yui/2.6.0/reset/reset-min.css'))}</pre>
</div>
<p>Always make sure the <tt class="docutils literal"><span class="pre">reset.css</span></tt> style sheet is defined before any others; otherwise, you might find that your carefully coded styles are reset when you didn’t expect them to be. You&#8217;ll need to add this import to your <tt class="docutils literal"><span class="pre">lib/helpers.py</span></tt> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webhelpers.html.tags</span> <span class="kn">import</span> <span class="n">stylesheet_link</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">It is much easier to use the YUI <tt class="docutils literal"><span class="pre">reset.css</span></tt> style at the beginning of a project before you define any styles rather than trying to apply it after other styles are already in place, so I strongly recommend you use it in all your projects from the beginning.</p>
</div>
<p>You can find more information about the <tt class="docutils literal"><span class="pre">reset.css</span></tt> style sheet at <a class="reference external" href="http://developer.yahoo.com/yui/reset/">http://developer.yahoo.com/yui/reset/</a>.</p>
<p>Once you have reset all the styles, there’s a good chance you’ll want some common ones back. For example, <tt class="docutils literal"><span class="pre">&lt;p&gt;</span></tt> tags usually have a margin, and the various headings should be different sizes. Once again, the YUI team has thought of this, and common styles are defined in the <tt class="docutils literal"><span class="pre">base.css</span></tt> file. You can add the <tt class="docutils literal"><span class="pre">base.css</span></tt> file by adding this line to the head of your HTML document:</p>
<div class="highlight-python"><pre>${h.stylesheet_link(h.url_for('/yui/2.6.0/base/base-min.css'))}</pre>
</div>
<p id="index-67">Notice that for both the base and reset style sheets, I have included minimized versions (they have <tt class="docutils literal"><span class="pre">-min</span></tt> added just before the file extension). These have all the unnecessary whitespace removed so that they are faster for a browser to download and parse. If you ever want to take a look at the styles they contain, you can look at the nonminimized versions, which are identical except for the whitespace.</p>
</div>
<div class="section" id="fonts">
<h2>Fonts<a class="headerlink" href="#fonts" title="Permalink to this headline">¶</a></h2>
<p id="index-68">Another area developers sometimes struggle with is fonts. Typically you want the fonts to display at a particular size across all browsers, but you don’t want to specify those sizes explicitly using <tt class="docutils literal"><span class="pre">px</span></tt> units because that would prevent certain browsers from adjusting the font size based on the size a user has chosen from a browser menu.</p>
<p>Once again, YUI has a style sheet that comes to the rescue, this time named <tt class="docutils literal"><span class="pre">fonts.css</span></tt>, which sets up font families and sizes so that they render consistently across browsers as 13-pixel Arial with 16-pixel line spaces. The <tt class="docutils literal"><span class="pre">&lt;pre&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;code&gt;</span></tt> elements render in monospace.</p>
<p id="index-69">You can then specify any font sizes you want to use as a percentage of the default sizes, as shown in Table 15-1.</p>
<table border="1" class="docutils">
<colgroup>
<col width="59%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">If You Want This Size in Pixels (px)</th>
<th class="head">Declare This Percent (%)</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>10</td>
<td>77</td>
</tr>
<tr><td>11</td>
<td>85</td>
</tr>
<tr><td>12</td>
<td>93</td>
</tr>
<tr><td>13</td>
<td>100</td>
</tr>
<tr><td>14</td>
<td>108</td>
</tr>
<tr><td>15</td>
<td>116</td>
</tr>
<tr><td>16</td>
<td>123.1</td>
</tr>
<tr><td>17</td>
<td>131</td>
</tr>
<tr><td>18</td>
<td>138.5</td>
</tr>
<tr><td>19</td>
<td>146.5</td>
</tr>
<tr><td>20</td>
<td>153.9</td>
</tr>
<tr><td>21</td>
<td>161.6</td>
</tr>
<tr><td>22</td>
<td>167</td>
</tr>
<tr><td>23</td>
<td>174</td>
</tr>
<tr><td>24</td>
<td>182</td>
</tr>
<tr><td>25</td>
<td>189</td>
</tr>
<tr><td>26</td>
<td>197</td>
</tr>
</tbody>
</table>
<p>Table 15-1. Pixels to Percent Translation</p>
<p>Be sure to always use percentages in your application, not the corresponding pixel size.</p>
<p id="index-70">You can include fonts support in a Pylons application by adding the following after the reset CSS import in the <tt class="docutils literal"><span class="pre">&lt;head&gt;</span></tt> section of your HTML:</p>
<div class="highlight-python"><pre>${h.stylesheet_link(h.url_for('/yui/2.6.0/fonts/fonts-min.css'))}</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The sharp-eyed amongst you might have spotted that you could achieve similar font standardization using ems, but the percentage technique described here results in more consistent rendering across browsers.</p>
</div>
<p>If you want to change the font family, you need to provide only the specific font you’re interested in and not any fallbacks. When your font is missing, YUI provides a fallback for you.</p>
<p>For example, you would write this:</p>
<div class="highlight-python"><pre>font-family: "Times New Roman";</pre>
</div>
<p id="index-71">and not this:</p>
<div class="highlight-python"><pre>font-family: "Times New Roman", serif;</pre>
</div>
</div>
<div class="section" id="grids">
<h2>Grids<a class="headerlink" href="#grids" title="Permalink to this headline">¶</a></h2>
<p id="index-72">Another frequent problem in web development is the creation of grid layouts. Of course, you can always use tables to lay out your HTML content, but this is considered bad practice and is heavily frowned upon by CSS experts because table-based designs don’t degrade gracefully. For example, with a table layout, if your screen resolution is too small, your users will be forced to scroll. CSS layouts, on the other hand, can cause one column of information to appear below another when the browser width is too small, which is generally considered better.</p>
<p>Sites such as Amazon still use table-based layout for some aspects of their pages, so the importance of always using CSS layouts all the time is debatable. Of course, you could also detect the screen resolution with JavaScript and provide a different layout for small screens, but this requires extra work and will not work if the browser doesn’t support JavaScript or has it disabled.</p>
<p>Using a CSS grid framework makes setting up a CSS layout much easier. First you should declare your doctype as HTML 4 strict to force browsers into standards mode for rendering. You can do this by making sure the top of your HTML file looks like this:</p>
<div class="highlight-python"><pre>&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd"&gt;
&lt;html&gt;
&lt;head&gt;</pre>
</div>
<p>You also need to include the YUI <tt class="docutils literal"><span class="pre">grids.css</span></tt> file, but using grids also requires the reset and fonts CSS files to be used. Rather than including three separate files, YUI also provides a combined and minified file called <tt class="docutils literal"><span class="pre">reset-fonts-grids.css</span></tt> that you can use instead like this:</p>
<div class="highlight-python"><pre>&lt;link rel="stylesheet" type="text/css"
    href="/yui/2.6.0/reset-fonts-grids/reset-fonts-grids.css"&gt;</pre>
</div>
<p>Although the file doesn’t have <tt class="docutils literal"><span class="pre">-min</span></tt> as part of the file name, this is a fully minified CSS file.</p>
<p id="index-73">You could also include this in a template with this line:</p>
<div class="highlight-python"><pre>${h.stylesheet_link(h.rul_for('/yui/2.6.0/reset-fonts-grids/reset-fonts-grids.css))}</pre>
</div>
<p>YUI assumes you will want a header, body, and footer in your HTML page, so to use the YUI grid, you need to set up your page’s HTML like this with a <tt class="docutils literal"><span class="pre">&lt;div&gt;</span></tt> tag containing three other <tt class="docutils literal"><span class="pre">&lt;div&gt;</span></tt> tags:</p>
<div class="highlight-python"><pre>&lt;div id="doc"&gt;
   &lt;div id="hd"&gt;&lt;!-- header --&gt;&lt;/div&gt;
   &lt;div id="bd"&gt;&lt;!-- body --&gt;&lt;/div&gt;
   &lt;div id="ft"&gt;&lt;!-- footer --&gt;&lt;/div&gt;
&lt;/div&gt;</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">id</span></tt> attribute of the inner <tt class="docutils literal"><span class="pre">&lt;div&gt;</span></tt> elements must be as shown earlier, but the <tt class="docutils literal"><span class="pre">id</span></tt> of the outer <tt class="docutils literal"><span class="pre">&lt;div&gt;</span></tt> element can be customized to determine the width of the page. You have the following options:</p>
<div class="highlight-python"><pre>&lt;!-- #doc = 750px width, centered--&gt;
&lt;div id="doc"&gt;&lt;/div&gt;

&lt;!-- #doc2 = 950px width, centered --&gt;
&lt;div id="doc2"&gt;&lt;/div&gt;

&lt;!-- #doc3 = 100% width --&gt;
&lt;div id="doc3"&gt;&lt;/div&gt;

&lt;!-- #doc4 = 974px width, centered --&gt;
&lt;div id="doc4"&gt;&lt;/div&gt;</pre>
</div>
<p id="index-74">It’s also possible to create your own page widths, but for the vast majority of cases, the YUI defaults are fine.</p>
<p id="index-75">As an example, to create a content area with a 100 percent width, you would use an <tt class="docutils literal"><span class="pre">id</span></tt> of <tt class="docutils literal"><span class="pre">doc3</span></tt> on the outer <tt class="docutils literal"><span class="pre">&lt;div&gt;</span></tt> element, as shown here:</p>
<div class="highlight-python"><pre>&lt;div id="doc3"&gt;
   &lt;div id="hd"&gt;&lt;!-- header --&gt;&lt;/div&gt;
   &lt;div id="bd"&gt;&lt;!-- body --&gt;&lt;/div&gt;
   &lt;div id="ft"&gt;&lt;!-- footer --&gt;&lt;/div&gt;
&lt;/div&gt;</pre>
</div>
<p>Once you’ve set up your template with the correct ID to specify the width of the content, you can think about how content within the header, body, and footer is arranged. YUI provides three types of grids you can use separately or combine to achieve a huge variety of different layouts:</p>
<blockquote>
<ul class="simple">
<li>Template presets</li>
<li>Nesting grids</li>
<li>Special nesting grids</li>
</ul>
</blockquote>
<p><em>Template presets</em> give you common configurations for two-column layouts with a column on the left or the right, and <em>nesting grids</em> and <em>special nesting grids</em> give you more control to produce more complex layouts, as you’ll see in the following sections.</p>
<div class="section" id="template-preset-grids">
<h3>Template Preset Grids<a class="headerlink" href="#template-preset-grids" title="Permalink to this headline">¶</a></h3>
<p id="index-76">Template preset grids are used after you have chosen the overall width of the content to subdivide either the header, body, or footer into two columns, one of which has a fixed width. To achieve, this you need to add some extra markup to either the header, body, or footer <tt class="docutils literal"><span class="pre">&lt;div&gt;</span></tt>. In this example we are splitting the body into two columns. The extra markup is shown in lines 3-6:</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;bd&quot;</span><span class="nt">&gt;</span>
     <span class="c">&lt;!-- body --&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;yui-main&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;yui-b&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;yui-b&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td></tr></table></div>
<p>You then choose which template preset to use by adding a class to the same outer <tt class="docutils literal"><span class="pre">&lt;div&gt;</span></tt> element that was used earlier to specify the width. Table 15-2 lists the options.</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Template Class</th>
<th class="head">Preset Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">.yui-t1</span></tt></td>
<td>160px on left</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">.yui-t2</span></tt></td>
<td>180px on left</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">.yui-t3</span></tt></td>
<td>300px on left</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">.yui-t4</span></tt></td>
<td>180px on right</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">.yui-t5</span></tt></td>
<td>240px on right</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">.yui-t6</span></tt></td>
<td>300px on right</td>
</tr>
</tbody>
</table>
<p>Table 15-2. Template Class Presets</p>
<p>As an example, to have a 240-pixel column on the right of the same layout that you saw in the previous example with a 100 percent width, you would use an outer <tt class="docutils literal"><span class="pre">&lt;div&gt;</span></tt> element with a <tt class="docutils literal"><span class="pre">class=&quot;yui-t5&quot;</span></tt> attribute:</p>
<div class="highlight-python"><pre>&lt;div id="doc3" class="yui-t5"&gt;
   &lt;div id="hd"&gt;&lt;!-- header --&gt;&lt;/div&gt;
   &lt;div id="bd"&gt;
       &lt;!-- body --&gt;
       &lt;div id="yui-main"&gt;
          &lt;div class="yui-b"&gt;&lt;/div&gt;
       &lt;/div&gt;
       &lt;div class="yui-b"&gt;&lt;/div&gt;
   &lt;/div&gt;
   &lt;div id="ft"&gt;&lt;!-- footer --&gt;&lt;/div&gt;
&lt;/div&gt;</pre>
</div>
<p id="index-77">This will produce the desired layout. What is more, you can also use a similar structure in the header and footer divs, but because it is the class of the outer div that defines the layout, the header, footer, and body all use the same layout with the template preset approach.</p>
<p>Sometimes you might want the content in the second <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;yui-b&quot;&gt;</span></tt> element to appear in the HTML before the first, perhaps for search engine optimization reasons or perhaps to put your navigation before your content for accessibility reasons. If you are using a YUI template preset, you can change the order of the two columns in the HTML without changing how they are displayed. For example, the altered markup in lines 5-8 will produce the same results:</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;doc3&quot;</span> <span class="na">class=</span><span class="s">&quot;yui-t5&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;hd&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- header --&gt;</span><span class="nt">&lt;/div&gt;</span>
   <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;bd&quot;</span><span class="nt">&gt;</span>
       <span class="c">&lt;!-- body --&gt;</span>
       <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;yui-b&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
       <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;yui-main&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;yui-b&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
       <span class="nt">&lt;/div&gt;</span>
   <span class="nt">&lt;/div&gt;</span>
   <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;ft&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- footer --&gt;</span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td></tr></table></div>
<p id="index-78">Notice that the naked <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;yui-b&quot;&gt;</span></tt> element now comes <em>before</em> the one wrapped in <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">id=&quot;yui-main&quot;&gt;</span></tt>.</p>
</div>
<div class="section" id="nested-grids">
<h3>Nested Grids<a class="headerlink" href="#nested-grids" title="Permalink to this headline">¶</a></h3>
<p id="index-79">Within the basic templates you can nest further grids so that each grid you nest divides the content area in two, with each area taking up 50 percent of the available space. Here’s an example of how to do this:</p>
<div class="highlight-python"><pre>&lt;div class="yui-g"&gt;
    &lt;div class="yui-u first"&gt; &lt;/div&gt;
    &lt;div class="yui-u"&gt; &lt;/div&gt;
&lt;/div&gt;</pre>
</div>
<p>The important point to notice is that the first child of the grid has to be marked with the class <tt class="docutils literal"><span class="pre">first</span></tt> to ensure the grids work in all the main browsers. You can also nest nested grids within other nested grids to create more complex layouts.</p>
</div>
<div class="section" id="special-nested-grids">
<h3>Special Nested Grids<a class="headerlink" href="#special-nested-grids" title="Permalink to this headline">¶</a></h3>
<p id="index-80">It isn’t always particularly useful to subdivide areas in half, so YUI provides five <em>special nested grids</em> that subdivide grids in the ratios given in Table 15-3.</p>
<table border="1" class="docutils">
<colgroup>
<col width="57%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Special Grid Class</th>
<th class="head">Ratios</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">.yui-gb</span></tt></td>
<td>1/3, 1/3, 1/3</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">.yui-gc</span></tt></td>
<td>2/3, 1/3</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">.yui-gd</span></tt></td>
<td>1/3, 2/3</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">.yui-ge</span></tt></td>
<td>3/4, 1/4</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">.yui-gf</span></tt></td>
<td>1/4, 3/4</td>
</tr>
</tbody>
</table>
<p>Table 15-3. Grid Class Ratios</p>
<p id="index-81">Let’s extend the example from the “Template Presets” section to use the <tt class="docutils literal"><span class="pre">yui-gf</span></tt> class in the header so that you can have a logo on the left taking up 1/4 of the page and the main navigation tabs on the right taking the remaining 3/4 of the space, while the body remains split in two with a 240-pixel column on the right.</p>
<p>Here’s what the updated HTML looks like:</p>
<div class="highlight-python"><pre>&lt;div id="doc3" class="yui-t5"&gt;
    &lt;div id="hd"&gt;
       &lt;div class="yui-gf"&gt;&lt;!-- the "special grid" --&gt;
         &lt;div class="yui-u first"&gt;&lt;img src="/image/logo.png" alt="Logo" /&gt;&lt;/div&gt;
         &lt;div class="yui-u"&gt;&lt;!-- Navigation tabs here --&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
   &lt;div id="bd"&gt;
       &lt;!-- body --&gt;
       &lt;div id="yui-main"&gt;
          &lt;div class="yui-b"&gt;&lt;/div&gt;
       &lt;/div&gt;
       &lt;div class="yui-b"&gt;&lt;/div&gt;
   &lt;/div&gt;
   &lt;div id="ft"&gt;&lt;!-- footer --&gt;&lt;/div&gt;
&lt;/div&gt;</pre>
</div>
<p id="index-82">Notice that although in this example you are using a special nested grid directly in the header, you can also put them within template preset regions and nested grids too.</p>
</div>
</div>
<div class="section" id="updating-simplesite-to-use-css-grids">
<h2>Updating SimpleSite to Use CSS Grids<a class="headerlink" href="#updating-simplesite-to-use-css-grids" title="Permalink to this headline">¶</a></h2>
<p id="index-83">Now that you’ve seen the theory of how to use YUI’s CSS reset style sheet, fonts, and grids, you can update the SimpleSite project to use them too.</p>
<p>Start by preparing the YUI source code as described at the beginning of the chapter:</p>
<div class="highlight-python"><pre>$ cd public
$ unzip yui_2.6.0.zip
$ cd yui
$ rm -r as-docs as-src assets docs examples tests index.html README
$ mv build 2.6.0</pre>
</div>
<p>Make sure the first HTML in the <tt class="docutils literal"><span class="pre">templates/base/index.html</span></tt> file looks like this:</p>
<div class="highlight-python"><pre>&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd"&gt;
&lt;html&gt;
&lt;head&gt;</pre>
</div>
<p>Then edit the <tt class="docutils literal"><span class="pre">head()</span></tt> def to add the YUI combined <tt class="docutils literal"><span class="pre">reset-fonts-grids.css</span></tt> file, which includes the grid styles:</p>
<div class="highlight-python"><pre>&lt;%def name="head()"&gt;
    ${h.stylesheet_link(h.url_for('/yui/2.6.0/reset-fonts-grids/reset-fonts-grids.css'))}
    ${h.stylesheet_link(h.url_for('/css/main.css'))}
&lt;/%def&gt;</pre>
</div>
<p>For this example, you’re going to have a two-column layout with a header and footer. You’d like the right column to be 240-pixels wide and contain the menu navigation and the list of tags that can be used on the page. You’ll put the main navigation tabs in the header and style the footer to match it.</p>
<p id="index-84">Replace the <tt class="docutils literal"><span class="pre">&lt;body&gt;</span></tt> part of the <tt class="docutils literal"><span class="pre">base/index.html</span></tt> file that currently looks like this:</p>
<div class="highlight-python"><pre>&lt;body&gt;
    ${self.header()}
    ${self.tabs()}
    ${self.menu()}
    ${self.heading()}
    ${self.breadcrumbs()}
    ${self.flash()}
    ${next.body()}
    ${self.footer()}
&lt;/body&gt;</pre>
</div>
<p id="index-85">with the YUI grids version that looks like the following. Notice the <tt class="docutils literal"><span class="pre">id=doc3</span></tt> attribute on the outer <tt class="docutils literal"><span class="pre">&lt;div&gt;</span></tt> element to make the content use 100 percent of the width. The <tt class="docutils literal"><span class="pre">self.heading()</span></tt> def is now also called in the header, not the body:</p>
<div class="highlight-python"><pre>&lt;body&gt;
    &lt;div id="doc3"&gt;
        &lt;div id="hd"&gt;
           ${self.heading()}
           ${self.header()}
           ${self.tabs()}
        &lt;/div&gt;
        &lt;div id="bd"&gt;
            ${self.breadcrumbs()}
            ${self.flash()}
            ${self.menu()}
            ${next.body()}
        &lt;/div&gt;
        &lt;div id="ft"&gt;
            ${self.footer()}
        &lt;/div&gt;
   &lt;/div&gt;
&lt;/body&gt;</pre>
</div>
<p>Next, add the markup to use a template preset for a 240-pixel column on the right. Notice the <tt class="docutils literal"><span class="pre">class=&quot;yui-t5&quot;</span></tt> attribute and the two extra <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;yui-b&quot;&gt;</span></tt> elements with the content for the two columns:</p>
<div class="highlight-python"><pre>&lt;body&gt;
    &lt;div id="doc3" class="yui-t5"&gt;
        &lt;div id="hd"&gt;
            ${self.heading()}
            ${self.header()}
            ${self.tabs()}
        &lt;/div&gt;
        &lt;div id="bd"&gt;
            &lt;div id="yui-main"&gt;
                &lt;div class="yui-b"&gt;
                    ${self.breadcrumbs()}
                    ${self.flash()}
                    ${next.body()}
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="yui-b"&gt;
                 ${self.menu()}
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div id="ft"&gt;
            ${self.footer()}
        &lt;/div&gt;
   &lt;/div&gt;
&lt;/body&gt;</pre>
</div>
<p id="index-86">Finally, modify the header to contain a logo or title on the left and space for some additional links on the right using a special nested grid:</p>
<div class="highlight-python"><pre>&lt;body&gt;
    &lt;div id="doc3" class="yui-t5"&gt;
        &lt;div id="hd"&gt;
             &lt;div class="yui-gc"&gt;
                 &lt;div class="yui-u first"&gt;${self.heading()}&lt;/div&gt;
                 &lt;div class="yui-u"&gt;&lt;/div&gt;
             &lt;/div&gt;
            ${self.header()}
            ${self.tabs()}
        &lt;/div&gt;
        &lt;div id="bd"&gt;
            &lt;div id="yui-main"&gt;
                &lt;div class="yui-b"&gt;
                    ${self.breadcrumbs()}
                    ${self.flash()}
                    ${next.body()}
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="yui-b"&gt;
                 ${self.menu()}
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div id="ft"&gt;
            ${self.footer()}
        &lt;/div&gt;
   &lt;/div&gt;
&lt;/body&gt;</pre>
</div>
<p id="index-87">You’ll use Arial in SimpleSite for the body text, but you’ll use Georgia for the headings. Since all the font styles have also been reset, you’ll need to specify the heading size too. Add this to the end of the <tt class="docutils literal"><span class="pre">public/css/main.css</span></tt> file:</p>
<div class="highlight-python"><pre>body{
    font-family: Arial;
}
#hd {
    background: #87AFD7;
    border-bottom: 3px solid #113958;
}
h1 {
    font-family: Georgia;
    color: #003;
    font-size: 197%;
    margin: 15px 20px 10px 20px;
}
h2 {
    font-family: Georgia;
    color: #003;
    font-size: 138.5%;
    margin-top: 1.5em;
}
#menu {
    padding-top: 20px;
}
#breadcrumbs {
    margin-bottom: 20px;
}
#doc3 {margin:auto;}
#bd, #ft {
    padding: 20px;
}
form {
    margin-top: 20px;
}
form table td {
    padding-bottom: 3px;
}</pre>
</div>
<p id="index-88">This particular grid template has a 10-pixel margin that you don’t need. The earlier <tt class="docutils literal"><span class="pre">#doc3</span></tt> style removes it. You’ll also need to tweak two of the <tt class="docutils literal"><span class="pre">#maintabs</span></tt> styles. They should now look like this:</p>
<div class="highlight-python"><pre>#maintabs ul {
    margin: 0px;
    padding: 0px;
    height: 21px;
}
#maintabs {
    margin: 0;
    padding: 10px 0 0px 17px;
}</pre>
</div>
<p>Now that you have two columns, let’s move the tags to the right column. Edit the <tt class="docutils literal"><span class="pre">templates/derived/page/view.html</span></tt> file so that the lines relating to the tags look like this:</p>
<div class="highlight-python"><pre>&lt;%def name="tags(available_tags)"&gt;
    &lt;h2&gt;Tags&lt;/h2&gt;
    ${h.form_start(h.url_for(controller='page', action='update_tags', id=c.page.id), method='post')}
        ${h.checkbox_group(name='tags', selected_values=None, align="vert", options=available_tags)}
        ${h.submit(value="Save Tags", name='submit')}
    ${h.form_end()}
&lt;/%def&gt;

&lt;%!
    from formencode import htmlfill
    from webhelpers.html import literal
%&gt;

&lt;%def name="menu()"&gt;
${parent.menu()}
% if c.available_tags:
${literal(htmlfill.render(capture(self.tags, c.available_tags), c.selected_tags))}
% endif
&lt;/%def&gt;</pre>
</div>
<p id="index-89">With these changes in place and with one <tt class="docutils literal"><span class="pre">Pylons</span></tt> tag added, the development home page now looks like Figure 15-1. You might need to force a browser refresh before the new styles are noticed. If the section links and tags aren&#8217;t on the right, check you have added the <tt class="docutils literal"><span class="pre">yui-t5</span></tt> class to the outer div.</p>
<div class="figure">
<a class="reference external image-reference" href="_images/9349f1501.png"><img alt="Figure 15-1. The SimpleSite development page with the CSS styles applied" src="_images/9349f1501.png" /></a>
<p class="caption">Figure 15-1. The SimpleSite development page with the CSS styles applied</p>
</div>
<p id="index-90">Now that you have a good understanding of modern CSS techniques and have seen how they are applied with the YUI framework, it’s time to investigate another tool of the modern web developer: JavaScript. Before you do that, though, I’ll introduce a very useful plug-in called Firebug that will help you greatly when using JavaScript in the browser.</p>
</div>
<div class="section" id="introducing-firebug">
<h2>Introducing Firebug<a class="headerlink" href="#introducing-firebug" title="Permalink to this headline">¶</a></h2>
<p id="index-91">When you are working with client-side code in the browser, you should consider using a tool that many developers find invaluable called Firebug. If you haven’t come across Firebug yet, it is a plug-in for the Firefox browser that contains a range of useful tools for client-side web development, including a JavaScript console, Document Object Model (DOM) inspector, debugger, profiler, CSS display, HTTP request and response analysis tool, and a CSS visualization and manipulation tool.</p>
<p id="index-92">If you don’t have Firebug installed already, you should install it now. First download Firefox from <a class="reference external" href="http://www.mozilla.com/firefox">http://www.mozilla.com/firefox</a>, and after installing it, install the Firebug plug-in from <a class="reference external" href="http://getfirebug.com/">http://getfirebug.com/</a>. Firebug is available only for Firefox, but if you aren’t already using Firefox for development, the Firebug plug-in is a good reason to consider switching.</p>
<p id="index-93">Let’s use the Firebug console to test some JavaScript. Start the SimpleSite application, and then visit <a class="reference external" href="http://localhost:5000/">http://localhost:5000/</a>. Open Firefox, and select Tools &gt; Firebug &gt; Open Firebug in New Window from the menu. (Alternatively, you can press Ctrl+F12 or Command+F12 on a Mac to open Firebug from within Firefox.) Select the boxes for Console, Script, and Net, and click the Enable Selected Panels for Localhost button, as shown in Figure 15-2.</p>
<div class="figure">
<a class="reference external image-reference" href="_images/9349f1502.png"><img alt="Figure 15-2. Enabling the Firebug add-on" src="_images/9349f1502.png" /></a>
<p class="caption">Figure 15-2. Enabling the Firebug add-on</p>
</div>
<p id="index-94">Once you’ve enabled Firebug, you will be able to test the JavaScript examples from the previous section in Firebug. Click the red square button on the bottom right of Firebug to put Firebug into multiline input mode. You can then enter JavaScript statements more than one line a time and click the Run button. In Figure 15-3, I’ve entered <tt class="docutils literal"><span class="pre">alert('Hello</span> <span class="pre">reader!')</span></tt> and clicked Run. Firebug copies the input to the console on the left and executes the JavaScript as if it were being executed in the scope of the browser window. This means you have access to all the DOM functions you would have if you were writing JavaScript for the browser normally.</p>
<div class="figure">
<a class="reference external image-reference" href="_images/9349f1503.png"><img alt="Figure 15-3. Using the JavaScript console" src="_images/9349f1503.png" /></a>
<p class="caption">Figure 15-3. Using the JavaScript console</p>
</div>
<p id="index-95">Firebug has a huge amount of useful functionality, some of which you’ll see over the course of this chapter. It’s well worth visiting <a class="reference external" href="http://getfirebug.com/">http://getfirebug.com</a> and clicking each of the pictures on the home page to get a full idea of what Firebug can do.</p>
</div>
<div class="section" id="introducing-javascript">
<h2>Introducing JavaScript<a class="headerlink" href="#introducing-javascript" title="Permalink to this headline">¶</a></h2>
<p id="index-96">Although Python programmers can typically get a long way by copying and tweaking JavaScript examples, if you want to write any serious code to run on the browser, you need to learn JavaScript properly.</p>
<p>JavaScript is a language in its own right, and although it is frequently used for DOM manipulation (changing HTML within a browser), the JavaScript language shouldn’t be confused with the DOM API.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">JavaScript isn’t actually based on Java at all but was given its name for political reasons between Sun and Netscape early in the history of web browsers. Microsoft also had an implementation called JScript, but today the standard is defined as ECMA-262, so JavaScript should really be known as ECMAScript.</p>
</div>
<p>At first glance, JavaScript appears fairly familiar to Python programmers; it has functions, hash tables (dictionaries), objects, and arrays as well as string, number, boolean, and date types. It also has all the standard control statements such as <tt class="docutils literal"><span class="pre">if</span></tt>, <tt class="docutils literal"><span class="pre">while</span></tt>, <tt class="docutils literal"><span class="pre">else</span></tt>, <tt class="docutils literal"><span class="pre">try</span></tt>, <tt class="docutils literal"><span class="pre">catch</span></tt>, and so on. Apart from curly braces and semicolons, JavaScript seems very approachable. Once you start using the language, though, you quickly realize that things aren’t quite as simple as they seem. Consider this example (I’m using <tt class="docutils literal"><span class="pre">js&gt;</span></tt> here to differentiate a JavaScript prompt from a traditional Python prompt <tt class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></tt>):</p>
<div class="highlight-python"><pre>js&gt; var a = [1,2,3,4];
js&gt; a.length;
4
js&gt; delete a[1];
js&gt; a
[1, undefined, 3, 4]
js&gt; a.length
4</pre>
</div>
<p id="index-97">As you can see, the <tt class="docutils literal"><span class="pre">Array</span></tt> type doesn’t behave much like the Python equivalent. In JavaScript an <tt class="docutils literal"><span class="pre">Array</span></tt> behaves more like a Python dictionary where all the keys are consecutive numbers than a traditional array.</p>
<p>Let’s look at functions:</p>
<div class="highlight-python"><pre>js&gt; function b(c, d) {
    alret(c);
    alert(d);
}
js&gt; b(1)</pre>
</div>
<p id="index-98">This doesn’t look a million miles from Python, but when you run it, you are shown two alert boxes with the values <tt class="docutils literal"><span class="pre">1</span></tt> and <tt class="docutils literal"><span class="pre">undefined</span></tt>. No error is thrown even though the function appears to take two parameters and you have specified only one. Try calling <tt class="docutils literal"><span class="pre">b()</span></tt> with three parameters, and you’ll find it appears to just ignore the third, again without an error. That’s not what you would expect from Python, although it’s perfectly rational once you understand how JavaScript works. As you’ll see later, functions in JavaScript also have a local variable called <tt class="docutils literal"><span class="pre">arguments</span></tt> that behaves a bit like an array of all the arguments passed.</p>
<p id="index-99">Perhaps the most obvious difference is in the way JavaScript handles inheritance. Unlike Python, JavaScript doesn’t have the concept of a class. Instead, it uses something called <em>prototypal inheritance</em> where objects inherit directly from other objects. This is quite different from Python and will cause you a good deal of confusion if you don’t understand it. As you’ll learn shortly, though, it is really rather simple.</p>
<p id="index-100">Another difference to be aware of is the way variables are defined. Consider this example:</p>
<div class="highlight-python"><pre>js&gt; var a = function() {
    b = 1;
    var c = 2;
}
js&gt; a()
js&gt; b
1
js&gt; c
undefined</pre>
</div>
<p>In this case, the variable <tt class="docutils literal"><span class="pre">c</span></tt> was declared using the <tt class="docutils literal"><span class="pre">var</span></tt> keyword so is considered local to the scope of function <tt class="docutils literal"><span class="pre">a()</span></tt>. Because <tt class="docutils literal"><span class="pre">b</span></tt> wasn’t declared using the <tt class="docutils literal"><span class="pre">var</span></tt> keyword, it was assigned to global scope. This is potentially a very bad thing because if a programmer forgot to use <tt class="docutils literal"><span class="pre">var</span></tt> when declaring another variable called <tt class="docutils literal"><span class="pre">b</span></tt> in another library you are using, both would refer to the same global <tt class="docutils literal"><span class="pre">b</span></tt>, which could cause problems that are difficult to track down.</p>
<p>In web browsers you can actually access the global scope directly because it is aliased as <tt class="docutils literal"><span class="pre">window</span></tt>. Continuing with the previous example, because <tt class="docutils literal"><span class="pre">b</span></tt> was declared without the <tt class="docutils literal"><span class="pre">var</span></tt> keyword, you could write this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">js</span><span class="o">&gt;</span> <span class="n">window</span><span class="o">.</span><span class="n">b</span>
<span class="mf">1</span>
</pre></div>
</div>
<p id="index-101">All the issues highlighted so far are simply meant to demonstrate that JavaScript is different from Python; it isn’t worse, but if you expect it to work like Python without learning its differences, you are likely to quickly get confused, particularly because JavaScript often returns the value <tt class="docutils literal"><span class="pre">undefined</span></tt> in situations where Python would raise an exception. I’ve seen many Python programmers curse JavaScript when their code doesn’t work the way it is supposed to, but if you take the time to learn it properly, you will quickly come to appreciate the language.</p>
</div>
<div class="section" id="javascript-essentials">
<h2>JavaScript Essentials<a class="headerlink" href="#javascript-essentials" title="Permalink to this headline">¶</a></h2>
<p id="index-102">This isn’t a book on JavaScript, so I don’t intend to go through the whole language in detail; I’ll give you enough of an understanding to start writing your own code and to highlight one or two traps Python programmers might fall into.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last" id="index-103">If you want to learn JavaScript, I highly recommend you invest the time in watching Douglas Crockford’s JavaScript videos. In them he talks you through all aspects of the language, inheritance, namespace issues, scope, closures, and more. Although the talks are fairly long, they are by far the most time-effective way to learn JavaScript properly. You’ll struggle to understand JavaScript without them. Douglas has also written a book recently called <em>JavaScript: The Good Parts</em>, which I can strongly recommend for teaching you the important principles of the JavaScript language while avoiding the traps. It isn’t focused on web development, though, but there are plenty of other books that are.</p>
</div>
<div class="section" id="operators-of-interest">
<h3>Operators of Interest<a class="headerlink" href="#operators-of-interest" title="Permalink to this headline">¶</a></h3>
<p id="index-104">The full list of operators is defined in the ECMAScript specification at <a class="reference external" href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">http://www.ecma-international.org/publications/standards/Ecma-262.htm</a>, but certain equality operators, such as the <tt class="docutils literal"><span class="pre">+</span></tt> and <tt class="docutils literal"><span class="pre">/</span></tt> operators, are of particular interest to Python programmers because their behavior is slightly different.</p>
<p id="index-105">JavaScript has two types of equality operators:</p>
<blockquote>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">===</span></tt> compares the type <em>and</em> value of the object. If they are different types or are the same type but with different values, the comparison will return <tt class="docutils literal"><span class="pre">false</span></tt>. Its inverse is <tt class="docutils literal"><span class="pre">!==</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">==</span></tt> tries to coerce one of the operands into the type of the other in order to make the comparison. Its inverse is <tt class="docutils literal"><span class="pre">!=</span></tt>.</li>
</ul>
</blockquote>
<p>If you don’t realize that <tt class="docutils literal"><span class="pre">==</span></tt> and <tt class="docutils literal"><span class="pre">!=</span></tt> could be changing the types of the values you are comparing, you could run into trouble. The vast majority of the time you will want to use <tt class="docutils literal"><span class="pre">===</span></tt> and <tt class="docutils literal"><span class="pre">!==</span></tt> since they are the conceptual equivalents of <tt class="docutils literal"><span class="pre">==</span></tt> and <tt class="docutils literal"><span class="pre">!=</span></tt> in Python. Using <tt class="docutils literal"><span class="pre">==</span></tt> and <tt class="docutils literal"><span class="pre">!=</span></tt> in JavaScript is usually a mistake.</p>
<p>The <tt class="docutils literal"><span class="pre">+</span></tt> operator is used for adding numbers together as you would expect, but it is also used for string concatenation. Python has this behavior too, but the difference between JavaScript and Python is that in JavaScript if any of the operands are not strings, it will silently convert them to strings and then concatenate them:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">js</span><span class="o">&gt;</span> <span class="mf">4</span><span class="o">+</span><span class="s">&quot;2&quot;</span>
<span class="s">&quot;42&quot;</span>
</pre></div>
</div>
<p>Python would raise a <tt class="docutils literal"><span class="pre">TypeError</span></tt> if you try to concatenate objects that aren’t strings or Unicode in Python, so it can be slightly unexpected. This also means you can do operations such as this in JavaScript to convert a string to a number:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">js</span><span class="o">&gt;</span> <span class="o">+</span><span class="s">&quot;42&quot;</span>
<span class="mf">42</span>
</pre></div>
</div>
<p>In Python the <tt class="docutils literal"><span class="pre">/</span></tt> operator doesn’t always mean a traditional divide operation. When the operands are integers, Python performs a floor divide operation. That is, it performs a division and discards the remainder. When one of the operands is a float, it performs a traditional division. For example:</p>
<div class="highlight-python"><pre># Python:
&gt;&gt;&gt; 10/3
3
&gt;&gt;&gt; 10/3.0
3.3333333333333335</pre>
</div>
<p id="index-106">In JavaScript, all numbers are 64-bit floating-point numbers (JavaScript doesn’t differentiate between floats and integers in the way Python does), so <tt class="docutils literal"><span class="pre">/</span></tt> always behaves like a Python operation on floats:</p>
<div class="highlight-python"><pre>// JavaScript
js&gt; 10/3
3.3333333333333335</pre>
</div>
</div>
<div class="section" id="types">
<h3>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h3>
<p id="index-107">JavaScript technically has nine types, although you’ll only ever use the data types: <tt class="docutils literal"><span class="pre">Undefined</span></tt>, <tt class="docutils literal"><span class="pre">Null</span></tt>, <tt class="docutils literal"><span class="pre">Boolean</span></tt>, <tt class="docutils literal"><span class="pre">String</span></tt>, <tt class="docutils literal"><span class="pre">Number</span></tt>, and <tt class="docutils literal"><span class="pre">Object</span></tt>. You will also come across the value <tt class="docutils literal"><span class="pre">NaN</span></tt>, and you will use arrays (which are objects) and functions.</p>
<p id="index-108">You’ll learn about objects a bit later in this chapter, so let’s start by looking at booleans. Booleans take the values <tt class="docutils literal"><span class="pre">true</span></tt> and <tt class="docutils literal"><span class="pre">false</span></tt> and behave as you would expect. In JavaScript, <tt class="docutils literal"><span class="pre">true==1</span></tt> is <tt class="docutils literal"><span class="pre">true</span></tt>, but <tt class="docutils literal"><span class="pre">true===1</span></tt> is <tt class="docutils literal"><span class="pre">false</span></tt> because a boolean is not the same as a number type.</p>
<p id="index-109">Strings consist of 16-bit characters (technically the UCS-2 character set if you are interested), although there is no character type as such. You represent a character as a string of length 1. Strings can be declared with either single or double quotes and are immutable, which means if you want to perform some operation on a string, it will create a new one rather than change the existing one.</p>
<p id="index-110">There is only one number type in JavaScript, and it is a 64-bit floating-point number. This can cause some problems because it means arithmetic is approximate. For example, 10/3 is not 31?3 but is 3.3333333333333335. Normally the small difference won’t be a problem, but in some circumstances it might be, so it is worth being aware of. There is a special value <tt class="docutils literal"><span class="pre">NaN</span></tt> that means “Not a Number,” which is the result of undefined or erroneous operations such as dividing by 0. This is unlike Python, which would raise an exception when an error occurred. Any arithmetic operation with <tt class="docutils literal"><span class="pre">NaN</span></tt> as an input will have <tt class="docutils literal"><span class="pre">NaN</span></tt> as a result, so it can sometimes be a little tricky to work out where the actual error occurred. <tt class="docutils literal"><span class="pre">NaN</span></tt> is not equal to anything, including <tt class="docutils literal"><span class="pre">NaN</span></tt>.</p>
<p id="index-111"><tt class="docutils literal"><span class="pre">null</span></tt> is a value that isn’t anything, analogous to <tt class="xref docutils literal"><span class="pre">None</span></tt> in Python. Many of the DOM operations such as <tt class="docutils literal"><span class="pre">document.getElementById()</span></tt> return <tt class="docutils literal"><span class="pre">null</span></tt> when a data structure cannot be found.</p>
<p id="index-112">The final value you will run into is <tt class="docutils literal"><span class="pre">undefined</span></tt>. It’s the default value for variables that haven’t been assigned a value yet and for parameters that are passed to a function. It is also the value of missing members in objects. Python doesn’t have anything equivalent to <tt class="docutils literal"><span class="pre">undefined</span></tt> because the same circumstances that would lead to an <tt class="docutils literal"><span class="pre">undefined</span></tt> value in JavaScript either aren’t possible or would cause an exception to be raised in Python. For example, Python is strict about the arguments passed to a function, and you would get a <tt class="docutils literal"><span class="pre">KeyError</span></tt> if you tried to access a member that didn’t exist. Python programmers tend to rely on these features of the language and are surprised when errors don’t occur in their JavaScript code. Once you understand JavaScript’s behavior in this regard, you are much less likely to be confused.</p>
<p id="index-113">It can sometimes be a bit tricky to remember how to check the type of objects or whether objects are <tt class="docutils literal"><span class="pre">null</span></tt> or <tt class="docutils literal"><span class="pre">undefined</span></tt>, so the YUI library defines some functions in <tt class="docutils literal"><span class="pre">YAHOO.lang</span></tt> that make it easier. Here are some examples from the YUI documentation:</p>
<div class="highlight-python"><pre>// true, an array literal is an array
YAHOO.lang.isArray([1, 2]);

// false, an object literal is not an array
YAHOO.lang.isArray({"one": "two"});

// however, when declared as an array, it is true
function() {
    var a = new Array();
    a["one"] = "two";
    return YAHOO.lang.isArray(a);
}();

// false, a collection of elements is like an array, but isn't
YAHOO.lang.isArray(document.getElementsByTagName("body"));

// true, false is a boolean
YAHOO.lang.isBoolean(false);

// false, 1 and the string "true" are not booleans
YAHOO.lang.isBoolean(1);
YAHOO.lang.isBoolean("true");

// null is null, but false, undefined and "" are not
YAHOO.lang.isNull(null); // true
YAHOO.lang.isNull(undefined); // false
YAHOO.lang.isNull(""); // false

// a function is a function, but an object is not
YAHOO.lang.isFunction(function(){}); // true
YAHOO.lang.isFunction({foo: "bar"}); // false

// true, ints and floats are numbers
YAHOO.lang.isNumber(0);
YAHOO.lang.isNumber(123.123);

// false, strings that can be cast to numbers aren't really numbers
YAHOO.lang.isNumber("123.123");

// false, undefined numbers and infinity are not numbers we want to use
YAHOO.lang.isNumber(1/0);

// true, objects, functions, and arrays are objects
YAHOO.lang.isObject({});
YAHOO.lang.isObject(function(){});
YAHOO.lang.isObject([1,2]);

// false, primitives are not objects
YAHOO.lang.isObject(1);
YAHOO.lang.isObject(true);
YAHOO.lang.isObject("{}");

// strings
YAHOO.lang.isString("{}"); // true
YAHOO.lang.isString({foo: "bar"}); // false
YAHOO.lang.isString(123); // false
YAHOO.lang.isString(true); // false

// undefined is undefined, but null and false are not
YAHOO.lang.isUndefined(undefined); // true
YAHOO.lang.isUndefined(false); // false
YAHOO.lang.isUndefined(null); // false</pre>
</div>
<p id="index-114">You might think that the results described here are obvious, but in fact performing the tests yourself can be quite tricky because there are often subtleties that can catch you out. It is much safer to use the YUI library’s functions when performing these tests.</p>
</div>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<p id="index-115">You can declare a function in two ways. The first is to give the function a name when you declare it as was done in the &#8220;Introducing JavaScript&#8221; section for the function <tt class="docutils literal"><span class="pre">b()</span></tt>. The second is to create an anonymous function and assign it to a variable, as shown here:</p>
<div class="highlight-python"><pre>js&gt; var change = function(a){ a = 2; }</pre>
</div>
<p>Both methods are equivalent, but anonymous functions can be very useful in their own right. There are actually four different ways to invoke functions, but in this chapter you’ll stick to the method that is most similar to Python.</p>
<p>As with Python, any objects passed into functions as parameters are passed by reference to functions. This means that if (within a function) you modify an object passed as a parameter to that function, you are actually modifying the object itself, not a copy of it:</p>
<div class="highlight-python"><pre>js&gt; var change = function(a) { a = 2; }
js&gt; var a = 1;
js&gt; change(a);
js&gt; a;
2</pre>
</div>
<p id="index-116">There is actually a subtlety going on when you call a function. In addition to the parameters you’ve passed in, you will find two other variables in the function’s scope: <tt class="docutils literal"><span class="pre">this</span></tt> and <tt class="docutils literal"><span class="pre">arguments</span></tt>. You’ll learn about <tt class="docutils literal"><span class="pre">this</span></tt> later, but <tt class="docutils literal"><span class="pre">arguments</span></tt> is an array-like object mentioned earlier that contains the values of each of the parameters passed to the function regardless of how many parameters the function is defined to accept. It is array-like because although it has a <tt class="docutils literal"><span class="pre">.length</span></tt> property, it is not formally a JavaScript <tt class="docutils literal"><span class="pre">Array</span></tt>. You can use it like this to create a function which multiplies all its arguments together:</p>
<div class="highlight-python"><pre>js&gt; function multiply() {
js&gt;     var i;
js&gt;     var n = arguments.length;
js&gt;     var result = 1;
js&gt;     for (i = 0; i &lt; n; i += 1) {
js&gt;         result *= arguments[i];
js&gt;     }
js&gt;     return result;
js&gt; }
js&gt; multiply(2, 3);
6</pre>
</div>
</div>
<div class="section" id="function-scope-and-closures">
<h3>Function Scope and Closures<a class="headerlink" href="#function-scope-and-closures" title="Permalink to this headline">¶</a></h3>
<p id="index-117">In JavaScript, variables exist in the scope of the function in which they were defined. This means that even if you put some variables within a block (using curly braces), the variables will have the same scope as they would before or after the block. For example:</p>
<div class="highlight-python"><pre>function a() {
    var a = 1;
    {
        a = 2;
        var b = 3;
    }
    alert(a); // will have the value 2
    alert(b); // will have the value 3
}
a();</pre>
</div>
<p>Because variables have function scope, it makes sense to just declare them all at the start of the function rather than when you first use them. This helps avoid the problem of assigning a value to a variable that hasn’t been declared with the <tt class="docutils literal"><span class="pre">var</span></tt> keyword and then finding it has accidentally been assigned to the global scope.</p>
<p>If a function in JavaScript is defined within another function, the inner function will still have access to the variables in the scope of the outer function, even after the outer function has returned.</p>
<p>As an example, think about how you would add an event handler to a button so that when it was clicked, an alert with a message would appear. Consider the following example where there are two buttons. The <tt class="docutils literal"><span class="pre">msg</span></tt> variable is assigned a value, and this is used as both an argument to the <tt class="docutils literal"><span class="pre">add_alert_handler()</span></tt> function and to <tt class="docutils literal"><span class="pre">show_alert()</span></tt>. Then the value of the message is changed.</p>
<div class="highlight-python"><pre>var add_alert_handler = function (message) {
    return function(e) {
        alert(message);
    };
};

var show_alert(message) {
    alert(message);
};

var msg = 'Alert button clicked';
document.getElementById('alert_button1').onclick = add_alert_handler(msg);
document.getElementById('alert_button2').onclick = show_alert(msg);
msg = 'The message has changed';</pre>
</div>
<p>When alert button 1 is clicked, the message displayed is “Alert button clicked,” but when alert button 2 is clicked, the message is “The message has changed.” The reason for this is simple. The function <tt class="docutils literal"><span class="pre">show_alert()</span></tt> has access to the <tt class="docutils literal"><span class="pre">msg</span></tt> variable’s value directly so that when <tt class="docutils literal"><span class="pre">msg</span></tt> gets changed, so does the value it displays. Alert button 1, on the other hand, uses a closure, so the value of <tt class="docutils literal"><span class="pre">message</span></tt> that the function defined within <tt class="docutils literal"><span class="pre">add_alert_handler()</span></tt> has access to is a copy defined only in the scope of the returned <tt class="docutils literal"><span class="pre">add_alert_handler()</span></tt> function. When the <tt class="docutils literal"><span class="pre">msg</span></tt> variable is changed, the <tt class="docutils literal"><span class="pre">message</span></tt> variable in the closure remains unchanged.</p>
<p id="index-118">If you are working with event handlers, you should always use closures or use a tool such as the YUI event library.</p>
</div>
<div class="section" id="objects">
<h3>Objects<a class="headerlink" href="#objects" title="Permalink to this headline">¶</a></h3>
<p id="index-119">In JavaScript, objects are similar to dictionaries in Python. For example, suppose you want an object with two attributes, <tt class="docutils literal"><span class="pre">name</span></tt> and <tt class="docutils literal"><span class="pre">age</span></tt>. You could write this in two ways:</p>
<div class="highlight-python"><pre>var object = new Object();
object.name = 'James';
object.age = 28;


object = {
    name: "James",
    age: 28
};</pre>
</div>
<p id="index-120">Both of these are identical because in JavaScript objects and dictionaries (or <em>hash tables</em> as they are called) are the same thing, but it is generally recommended you use the object literal notation to define objects (the example using the curly brackets) because it is clearer what is happening.</p>
<p>Regardless of how you create your objects, you can add new members or access existing members using either <tt class="docutils literal"><span class="pre">.</span></tt> or <tt class="docutils literal"><span class="pre">[]</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">js</span><span class="o">&gt;</span> <span class="nb">object</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Mike&#39;</span><span class="p">;</span>
<span class="n">js</span><span class="o">&gt;</span> <span class="nb">object</span><span class="o">.</span><span class="n">name</span><span class="p">;</span>
<span class="s">&#39;Mike&#39;</span>
<span class="n">js</span><span class="o">&gt;</span> <span class="nb">object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Ben&#39;</span><span class="p">;</span>
<span class="n">js</span><span class="o">&gt;</span> <span class="nb">object</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">];</span>
<span class="s">&#39;Ben&#39;</span>
</pre></div>
</div>
<p>One point to be aware of is that quite a few words in JavaScript are reserved even though they aren’t used. You can access object members whose names are not reserved words using the <tt class="docutils literal"><span class="pre">.</span></tt> notation. You can access any member regardless of the name using the <tt class="docutils literal"><span class="pre">[]</span></tt> notation.</p>
<p id="index-121">As well as assigning strings and numbers to objects, you can also assign functions:</p>
<div class="highlight-python"><pre>var simpleMaths = {
    add: function(a,b){
        return a+b;
    },
    subtract: function(a,b){
        return a-b;
    }
};</pre>
</div>
<p>You can now use your object for calculations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">js</span><span class="o">&gt;</span> <span class="n">simpleMaths</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mf">1</span><span class="o">+</span><span class="mf">1</span><span class="p">);</span>
<span class="mf">2</span>
</pre></div>
</div>
<p id="index-122">You can probably already see that this object is beginning to behave a bit like Python objects with methods.</p>
</div>
<div class="section" id="this">
<h3>this<a class="headerlink" href="#this" title="Permalink to this headline">¶</a></h3>
<p id="index-123"><tt class="docutils literal"><span class="pre">this</span></tt> is available in any function; its value is bound at runtime, and what it refers to depends on the calling form of the function that was called. For ordinary functions that are not members of an object, <tt class="docutils literal"><span class="pre">this</span></tt> refers to the global namespace, that isn’t particularly useful but when the function is bound to an object, <tt class="docutils literal"><span class="pre">this</span></tt> refers to the object itself. This is useful because it allows you to access the other members of the object from within the function. In the context of a method, <tt class="docutils literal"><span class="pre">this</span></tt> behaves like an implicit version of Python’s <tt class="docutils literal"><span class="pre">self</span></tt>. Here’s an example:</p>
<div class="highlight-python"><pre>var simpleMaths = {
    _value: 0
    add: function(a){
        return this._value + a;
    },
    subtract: function(a){
        return this._value - b;
    }
};</pre>
</div>
<p>This time the functions use a member variable to store a value, and then the methods add and subtract from that value. In Python any class member that starts with an <tt class="docutils literal"><span class="pre">_</span></tt> character is considered private, and although the programmer is asked politely not to modify private members, the language itself doesn’t prevent you from doing so.</p>
<p id="index-124">In JavaScript, you can use closures to create member variables that genuinely are private:</p>
<div class="highlight-python"><pre>var singleton = function () {
    var privateVariable;
    function privateFunction(x) {
        // do something with privateVariable
    }

    return {
        firstMethod: function (a, b) {
            // do something with privateVariable, privateFunction(),
            // this.firstMetod() or this.secondMethod()
        },
        secondMethod: function (c) {
            // do something with privateVariable, privateFunction(),
            // this.firstMetod() or this.secondMethod()
        }
    };
}();</pre>
</div>
<p id="index-125">In this example, <tt class="docutils literal"><span class="pre">privateVariable</span></tt> and <tt class="docutils literal"><span class="pre">privateFunction()</span></tt> are declared in the scope of the function, so because of closure, <tt class="docutils literal"><span class="pre">firstMethod()</span></tt> and <tt class="docutils literal"><span class="pre">secondMethod()</span></tt> have access to them even after the function returns. The brackets after the final curly brace call the function, so <tt class="docutils literal"><span class="pre">singleton</span></tt> is assigned the object returned by the function, but with each of the methods still having access to the private variable and function. This means you can do this to call <tt class="docutils literal"><span class="pre">firstMethod()</span></tt> or <tt class="docutils literal"><span class="pre">secondMethod()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">js</span><span class="o">&gt;</span> <span class="n">singleton</span><span class="o">.</span><span class="n">firstMethod</span><span class="p">();</span>
</pre></div>
</div>
<p id="index-126">but you can’t access <tt class="docutils literal"><span class="pre">singleton.privateVariable</span></tt> or <tt class="docutils literal"><span class="pre">singleton.privateFunction()</span></tt>. They are truly private in this case, unlike in Python.</p>
</div>
<div class="section" id="namespaces">
<h3>Namespaces<a class="headerlink" href="#namespaces" title="Permalink to this headline">¶</a></h3>
<p id="index-127">Because variables in JavaScript are declared in the global namespace if they are not declared with the <tt class="docutils literal"><span class="pre">var</span></tt> keyword inside a function, it is fairly easy for programs that use the same names in the global namespace to change each other’s variables accidentally.</p>
<p id="index-128">One solution to this problem is to set up a single object as global for your application and take special care to create all your application’s other objects and variables as members of that object. This is exactly what happens in YUI where all the functionality of the library is contained within the <tt class="docutils literal"><span class="pre">YAHOO</span></tt> namespace.</p>
<p>YUI recommends you choose an all-uppercase name for your namespace to minimize the chance of your name conflicting with an application that is already using that name. Say you wanted to create one called <tt class="docutils literal"><span class="pre">SIMPLESITE</span></tt>. You could do this:</p>
<div class="highlight-python"><pre>var SIMPLESITE = {};</pre>
</div>
<p>Now when you want to create objects global to your application, you can add them as members of the <tt class="docutils literal"><span class="pre">SIMPLESITE</span></tt> object like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">SIMPLESITE</span><span class="p">[</span><span class="s">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1</span><span class="p">;</span>
</pre></div>
</div>
<p>and access the <tt class="docutils literal"><span class="pre">test</span></tt> variable like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">SIMPLESITE</span><span class="o">.</span><span class="n">test</span><span class="p">;</span>
</pre></div>
</div>
<p>If you are writing a YUI component, you might like to use the <tt class="docutils literal"><span class="pre">YAHOO.namespace()</span></tt> function that sets up a namespace for you under the <tt class="docutils literal"><span class="pre">YAHOO</span></tt> namespace. You can also use it to set up nested namespaces if you specify the namespaces you want separated by a <tt class="docutils literal"><span class="pre">.</span></tt> character. For example:</p>
<div class="highlight-python"><pre>// Creates a namespace for "myproduct2", and for "mysubproject1"
YAHOO.namespace("myproduct1.mysubproject1");
YAHOO.myproduct1.mysubproject1.Class1 = function(info) {
    // do something here...
};</pre>
</div>
<p>Closures and anonymous functions can also be used to wrap an entire application in a function, keeping its namespace localized:</p>
<div class="highlight-python"><pre>function() {
// local namespace declarations here.
}()</pre>
</div>
<p id="index-129">The last <tt class="docutils literal"><span class="pre">()</span></tt> invokes the function.</p>
</div>
<div class="section" id="inheritance">
<h3>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h3>
<p id="index-130">Inheritance is object-oriented code reuse, which is a useful pattern. In the classical model, objects are instances of classes, and classes inherit from other classes. In the prototypal model, objects inherit directly from other objects, and there are no classes. They do this with a secret link to the object being inherited from. In Mozilla browsers, you can actually access this secret link with <tt class="docutils literal"><span class="pre">__proto__</span></tt>, but this is nonstandard and shouldn’t be used.</p>
<p id="index-131">JavaScript actually has a third way to create an object that I didn’t mention earlier: via an <tt class="docutils literal"><span class="pre">object()</span></tt> function. The function isn’t part of JavaScript, but you can write it easily enough yourself like this:</p>
<div class="highlight-python"><pre>function object(o) {
    function F() {}
    F.prototype = o;
    return new F();
}</pre>
</div>
<p>When you use this function, you can specify which object your object should be linked to:</p>
<div class="highlight-python"><pre>var oldObject = {
    firstMethod: function () {...},
    secondMethod: function () {...}
};

// create a new instance of the object
var newObject = object(oldObject);

// augment it
newObject.thirdMethod = function () {...};

// create a new instance of the augmented object
var thirdObject = object(newObject);

// this object has all three methods we've defined.
thirdObject.firstMethod();</pre>
</div>
<p id="index-132">This is very simple and doesn’t need traditional classes. If you try to access a property of the object and the object lacks that property, each object in the inheritance chain will be tested, and if it has the property, that property will be used. Finally, if the member can’t be found in any of the objects, then <tt class="docutils literal"><span class="pre">undefined</span></tt> will be returned. The name for this pattern is <em>linkage</em>.</p>
<p>This model has a few interesting consequences. For example, if you were to change the <tt class="docutils literal"><span class="pre">firstMethod()</span></tt> of <tt class="docutils literal"><span class="pre">oldObject</span></tt>, the change would be immediately visible in <tt class="docutils literal"><span class="pre">newObject</span></tt> and <tt class="docutils literal"><span class="pre">thirdObject</span></tt>. Changes to <tt class="docutils literal"><span class="pre">thirdObject</span></tt> will have no effect on <tt class="docutils literal"><span class="pre">oldObject</span></tt> or <tt class="docutils literal"><span class="pre">newObject</span></tt> because when their members are accessed, it is only the objects <em>they</em> are linked to that are searched.</p>
<p>If you were to change the <tt class="docutils literal"><span class="pre">thirdMethod()</span></tt> method of <tt class="docutils literal"><span class="pre">thirdObject</span></tt>, then <tt class="docutils literal"><span class="pre">thirdObject.thirdMethod()</span></tt> would behave differently from <tt class="docutils literal"><span class="pre">newObject.thirdMethod()</span></tt> because they now point to different functions. In this circumstance, deleting <tt class="docutils literal"><span class="pre">thirdMethod()</span></tt> from <tt class="docutils literal"><span class="pre">thirdObject</span></tt> won’t actually delete the method entirely; it will just delete the function assigned to the name <tt class="docutils literal"><span class="pre">thirdMethod</span></tt> <em>for</em> <tt class="docutils literal"><span class="pre">thirdObject</span></tt>, but because <tt class="docutils literal"><span class="pre">thirdObject</span></tt> is still linked to <tt class="docutils literal"><span class="pre">newObject</span></tt> when you access <tt class="docutils literal"><span class="pre">thirdObject.thirdMethod()</span></tt>, the <tt class="docutils literal"><span class="pre">thirdMethod()</span></tt> from <tt class="docutils literal"><span class="pre">newObject</span></tt> will be called instead. This might surprise you if you don’t understand that linkage works in only one direction. Incidentally, JavaScript doesn’t impose any limits on the lengths of the inheritance chains you can create, but bear in mind that deep nested object hierarchies require lots of lookups so aren’t as efficient as shallow hierarchies.</p>
<p id="index-133">The process of adding new methods and members to an object is called <em>augmentation</em>.</p>
</div>
<div class="section" id="prototypes">
<h3>Prototypes<a class="headerlink" href="#prototypes" title="Permalink to this headline">¶</a></h3>
<p id="index-134">You might be wondering what an object’s secret link points to if you create an object that isn’t explicitly linked to anything else. The answer is that it points to <tt class="docutils literal"><span class="pre">Object.prototype</span></tt> that contains a number of methods that all objects therefore inherit.</p>
<p>Similar prototypes exist for other types:</p>
<blockquote>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Object.prototype</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Array.prototype</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Function.prototype</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Number.prototype</span></tt></li>
<li><tt class="docutils literal"><span class="pre">String.prototype</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Boolean.prototype</span></tt></li>
</ul>
</blockquote>
<p>and these can be used to modify how all objects of their type behave.</p>
<p>It isn’t considered particularly good practice to modify the prototype, though, because it’s possible that modifications made by one JavaScript application will affect how another application behaves.</p>
<p id="index-135">When you iterate over an object in a <tt class="docutils literal"><span class="pre">for</span></tt> loop, you get all of its members, all of its parent’s members, all of its parent’s parent’s members, and so on, right down to all the members of <tt class="docutils literal"><span class="pre">Object.prototype</span></tt>. This isn’t always what you want, so JavaScript has a <tt class="docutils literal"><span class="pre">hasOwnProperty()</span></tt> function used like this:</p>
<div class="highlight-python"><pre>for (var name in object) {
    if (object.hasOwnProperty(name)) {
        // within the loop, name is the key of the current member
        // object[name] is the current value

        // only names associated with members of the current object
        // will be available here
    }
}</pre>
</div>
<p id="index-136">This enables you to distinguish between the object you want to iterate over and its parent members.</p>
</div>
<div class="section" id="javascript-in-html">
<h3>JavaScript in HTML<a class="headerlink" href="#javascript-in-html" title="Permalink to this headline">¶</a></h3>
<p id="index-137">It is generally not a good idea to include too much JavaScript in the body of an HTML document because it is harder to version control, compress, or validate with external tools. A much better way is to write JavaScript in a separate text file and include it in the HTML document like this:</p>
<div class="highlight-python"><pre>&lt;script src="/yourscript.js" /&gt;</pre>
</div>
<p>You don’t need to use <tt class="docutils literal"><span class="pre">language=&quot;javascript&quot;</span></tt>; it is a leftover from a time when Microsoft wanted people to be able to use VBScript in browsers, and you don’t actually need to use <tt class="docutils literal"><span class="pre">type=&quot;text/javascript&quot;</span></tt> because the correct MIME type for JavaScript is <tt class="docutils literal"><span class="pre">application/javascript</span></tt> or <tt class="docutils literal"><span class="pre">application/ecmascript</span></tt> and because the browser trusts the MIME type set by the server that serves the document over what you specify in the <tt class="docutils literal"><span class="pre">&lt;script&gt;</span></tt> tag. That being said, if you want your XHTML to be valid, you should add the <tt class="docutils literal"><span class="pre">type=&quot;text/javascript&quot;</span></tt> attribute.</p>
<p>Another leftover from the past is the way developers use comments to hide JavaScript embedded in HTML from old browsers. They might do this:</p>
<div class="highlight-python"><pre>&lt;script&gt;
&lt;!--
    alert("Script goes here.");
// --&gt;
&lt;/script&gt;</pre>
</div>
<p id="index-138">If browsers come across tags they don’t understand, they are supposed to ignore the tag but continue processing other nested tags. This means very old browsers that didn’t understand JavaScript would print the JavaScript as text, and the comments would force them to ignore the JavaScript instead. Nowadays, there are so few of these browsers left that you might just as well ignore the comments. If you include your JavaScript from separate files (as advised earlier), you avoid this problem anyway.</p>
</div>
</div>
<div class="section" id="the-document-object-model">
<h2>The Document Object Model<a class="headerlink" href="#the-document-object-model" title="Permalink to this headline">¶</a></h2>
<p id="index-139">As well as understanding the basics of the JavaScript language, it is useful to understand a little bit about how browsers work and how they deal with web pages returned from Pylons using the Document Object Model (DOM).</p>
<p id="index-140">The DOM is an API for HTML and XML documents. It provides a representation of the document, enabling you to modify its structure and content as well as the way the HTML elements are rendered. All the properties, methods, and events from the DOM are organized into objects so that they can be accessed from JavaScript. In fact, some of the functions you might use quite frequently when programming JavaScript actually come from the DOM and not the JavaScript language itself. For example, <tt class="docutils literal"><span class="pre">setTimeout()</span></tt>, <tt class="docutils literal"><span class="pre">alert()</span></tt>, <tt class="docutils literal"><span class="pre">confirm()</span></tt>, and <tt class="docutils literal"><span class="pre">prompt(text,</span> <span class="pre">default)</span></tt> are all DOM functions.</p>
<p>The vast majority of coding you will do for the web browser will use the DOM APIs, and although the JavaScript language itself is similar across browsers, the DOM APIs that different browsers expose can still be different in some frustrating ways. It is these differences more than anything else that make client-side web development in JavaScript difficult, and it is why you are strongly advised to use a framework such as YUI or JQuery to abstract away the complications.</p>
<p id="index-141">The basis of the DOM is the parse tree generated when the browser parses the HTML. The top of the parse tree is the <tt class="docutils literal"><span class="pre">#document</span></tt> element. Beneath it the individual nodes are available, and any text between HTML tags is stored in a <tt class="docutils literal"><span class="pre">#text</span></tt> node. Internet Explorer ignores whitespace, whereas the W3C DOM standard includes it as text nodes. It’s worth noting that the HTML elements are named with the uppercase version of their tag name, so <tt class="docutils literal"><span class="pre">node.tagName</span></tt> for the <tt class="docutils literal"><span class="pre">&lt;body&gt;</span></tt> node will be <tt class="docutils literal"><span class="pre">BODY</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">#document</span></tt> node can be accessed from JavaScript as the global <tt class="docutils literal"><span class="pre">document</span></tt>. The element representing the <tt class="docutils literal"><span class="pre">&lt;body&gt;</span></tt> tag is accessed as <tt class="docutils literal"><span class="pre">document.body</span></tt>, and the element representing the <tt class="docutils literal"><span class="pre">&lt;html&gt;</span></tt> tag is <tt class="docutils literal"><span class="pre">document.documentElement</span></tt>. This arguably isn’t the best naming convention, but it is the one we are stuck with. It’s worth noting that the browser might add elements such as <tt class="docutils literal"><span class="pre">&lt;head&gt;</span></tt> to the DOM tree even if they weren’t present in the original HTML, so the DOM tree doesn’t always exactly match the HTML source.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Try entering <tt class="docutils literal"><span class="pre">document.documentElement</span></tt> into a Firebug console to double-check this. If you click the <tt class="docutils literal"><span class="pre">&lt;html&gt;</span></tt> object displayed as the return value in the console, Firebug will open its HTML view at that element. From there you can click the DOM tab to see all properties associated with that element. This is typical of the sort of useful functionality Firebug contains.</p>
</div>
<p id="index-142">Each HTML element in the tree can be given an ID to uniquely identify it, which means the same ID cannot be used by two elements in the page. You can then access the DOM element for that node with this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that the last part of the method is <tt class="docutils literal"><span class="pre">Id</span></tt> and not <tt class="docutils literal"><span class="pre">ID</span></tt> as you might have expected. You can also access elements that have a <tt class="docutils literal"><span class="pre">name</span></tt> attribute like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">document</span><span class="o">.</span><span class="n">getElementsByName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>Because there can be more than one element with the same name in the DOM tree, this function uses the plural <tt class="docutils literal"><span class="pre">Elements</span></tt> and returns an array. The <tt class="docutils literal"><span class="pre">name</span></tt> attribute should be used for form fields and for the names of windows and frames, and the <tt class="docutils literal"><span class="pre">id</span></tt> attribute should be used everywhere else.</p>
<p>You can also access the nodes beneath a particular node by the name of their tags like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">node</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="n">tagName</span><span class="p">)</span>
</pre></div>
</div>
<p id="index-143">It is also possible to access certain collections of DOM elements as properties of the <tt class="docutils literal"><span class="pre">document</span></tt> object, such as <tt class="docutils literal"><span class="pre">document.forms</span></tt>, <tt class="docutils literal"><span class="pre">document.images</span></tt>, and the Microsoft-specific <tt class="docutils literal"><span class="pre">document.all</span></tt>. Generally speaking, it is better to give the elements you are interested in a <tt class="docutils literal"><span class="pre">name</span></tt> or <tt class="docutils literal"><span class="pre">id</span></tt> attribute and just use the methods mentioned earlier rather than using the collections.</p>
<div class="section" id="navigating-the-dom">
<h3>Navigating the DOM<a class="headerlink" href="#navigating-the-dom" title="Permalink to this headline">¶</a></h3>
<p id="index-144">Each element in the DOM beneath <tt class="docutils literal"><span class="pre">#document</span></tt> holds a number of references to other DOM elements so that you can easily navigate the DOM:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">.firstChild</span></tt></dt>
<dd>The first child element in the DOM structure</dd>
<dt><tt class="docutils literal"><span class="pre">.lastChild</span></tt></dt>
<dd>The last child element in the DOM structure</dd>
</dl>
<p>If there are no children, these properties will return <tt class="docutils literal"><span class="pre">null</span></tt>. If there is only one child node, they will both reference that child element:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">.childNodes</span></tt></dt>
<dd>Returns an array of all the child nodes or an empty array <tt class="docutils literal"><span class="pre">[]</span></tt> if there are no children</dd>
<dt><tt class="docutils literal"><span class="pre">.parentNode</span></tt></dt>
<dd>References the parent node</dd>
</dl>
<p>There are also properties for finding the next and previous sibling elements at the same level of the DOM; unsurprisingly, these are as follows:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">.nextSibling</span></tt></dt>
<dd>The next sibling node at the same level</dd>
<dt><tt class="docutils literal"><span class="pre">.previousSibling</span></tt></dt>
<dd>The next sibling node at the same level</dd>
</dl>
<p>Once again, these return <tt class="docutils literal"><span class="pre">null</span></tt> if there is no next or previous sibling.</p>
<p>With these properties in place, it is possible to define a function to walk the DOM tree and apply a particular function to each node. This is a handy pattern to use for DOM manipulation:</p>
<div class="highlight-python"><pre>function walkTheDOM(node, func) {
    func(node);
    node = node.firstChild;
    while (node) {
        walkTheDOM(node, func);
        node = node.nextSibling;
    }
}</pre>
</div>
<p id="index-145">Once you’ve obtained the DOM element you want to manipulate, you will want to know what you can change. The short answer is that you are likely to be able to set using JavaScript anything that can be set as an HTML attribute. If you have installed Firebug, you can click the Inspect button and select the element you want to inspect with the mouse. Right-clicking the element in the HTML view and clicking Inspect in DOM Tab will show you all the properties available to edit. These include things such as <tt class="docutils literal"><span class="pre">title</span></tt>, <tt class="docutils literal"><span class="pre">alt</span></tt>, <tt class="docutils literal"><span class="pre">value</span></tt>, <tt class="docutils literal"><span class="pre">src</span></tt>, <tt class="docutils literal"><span class="pre">className</span></tt> (which couldn’t be called <tt class="docutils literal"><span class="pre">class</span></tt> because it is a reserved word in JavaScript), and others. You can edit them directly in Firebug to see their effect. Rather than learning all the available attributes or trawling through the DOM specifications, it is generally easiest to look up available DOM properties in Firebug in this way, although bear in mind other browsers might be slightly different.</p>
<p id="index-146">You can also easily change the CSS style of elements by changing the node’s <tt class="docutils literal"><span class="pre">.style</span></tt>. This is another JavaScript object whose properties map to CSS styles. The only complication is that although CSS styles have names like <tt class="docutils literal"><span class="pre">font-family</span></tt> or <tt class="docutils literal"><span class="pre">background-color</span></tt>, their DOM counterparts are named in CamelCase, so the two examples become <tt class="docutils literal"><span class="pre">fontFamily</span></tt> and <tt class="docutils literal"><span class="pre">backgroundColor</span></tt>. As an example, here’s how you would write a function using the earlier <tt class="docutils literal"><span class="pre">walkTheDOM()</span></tt> function to change the CSS <tt class="docutils literal"><span class="pre">border-style</span></tt> and <tt class="docutils literal"><span class="pre">border-width</span></tt> of all images that have an <tt class="docutils literal"><span class="pre">&lt;a&gt;</span></tt> tag as their parents, starting at the <tt class="docutils literal"><span class="pre">#document</span></tt> node:</p>
<div class="highlight-python"><pre>walkTheDOM(document, function(node) {
    if (node.tagName === 'IMG' &amp;&amp; node.parentNode.tagName === 'A'){
node.style.borderStyle = 'dotted';
node.style.borderWidth = '3px';
    }
})</pre>
</div>
<p id="index-147">Notice that the node names were uppercase; that we used the <tt class="docutils literal"><span class="pre">===</span></tt> comparison operator, which is the one that doesn’t coerce types; and that the CSS <tt class="docutils literal"><span class="pre">border-style</span></tt> was set with the <tt class="docutils literal"><span class="pre">borderStyle</span></tt> member and the <tt class="docutils literal"><span class="pre">border-width</span></tt> was set with <tt class="docutils literal"><span class="pre">borderWidth</span></tt>.</p>
</div>
<div class="section" id="manipulating-the-dom">
<h3>Manipulating the DOM<a class="headerlink" href="#manipulating-the-dom" title="Permalink to this headline">¶</a></h3>
<p id="index-148">The DOM also provides methods for manipulating the DOM. If you’ve ever done any XML DOM work using Python’s <tt class="docutils literal"><span class="pre">xml.dom.minidom</span></tt> module, these methods will be familiar to you.</p>
<p>These methods create new DOM nodes that won’t yet be linked to the DOM:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">document.createElement(tagName)</span></tt></dt>
<dd>Creates a tag of type <tt class="docutils literal"><span class="pre">tagName</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">document.createTextNode(text)</span></tt></dt>
<dd>Creates a text node.</dd>
<dt><tt class="docutils literal"><span class="pre">node.cloneNode()</span></tt></dt>
<dd>Clones an individual element on its own.</dd>
<dt><tt class="docutils literal"><span class="pre">node.cloneNode(true)</span></tt></dt>
<dd>Clones an element and all of its descendents.</dd>
</dl>
<p>These methods manipulate the DOM:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">node.appendChild(new)</span></tt></dt>
<dd>Adds the new node or tree of nodes as the last child of <tt class="docutils literal"><span class="pre">node</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">node.removeChild(child)</span></tt></dt>
<dd>Removes the child node <tt class="docutils literal"><span class="pre">child</span></tt> from <tt class="docutils literal"><span class="pre">node</span></tt> and returns it</dd>
<dt><tt class="docutils literal"><span class="pre">node.insertBefore(new,</span> <span class="pre">sibling)</span></tt></dt>
<dd>Adds the new node or tree of nodes as a child of <tt class="docutils literal"><span class="pre">node</span></tt> but before the node <tt class="docutils literal"><span class="pre">sibling</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">old.parentNode.replaceChild(new,</span> <span class="pre">old)</span></tt></dt>
<dd>Replaces the node <tt class="docutils literal"><span class="pre">old</span></tt> with the node or node tree <tt class="docutils literal"><span class="pre">new</span></tt></dd>
</dl>
<p>Notice the syntax of the <tt class="docutils literal"><span class="pre">replaceChild()</span></tt> method is a little messy because it requires access to the parent node of the node being replaced. This is how the API works, though.</p>
<p id="index-149">It can be quite cumbersome to programmatically build DOM structures using the methods outlined earlier, so most modern browsers also provide an <tt class="docutils literal"><span class="pre">.innerHTML</span></tt> attribute to each node. Any value set as the value of <tt class="docutils literal"><span class="pre">.innerHTML</span></tt> is parsed by the browser’s HTML parser and converted into DOM nodes, replacing the node’s existing children. This is really handy because you can generate complex fragments of HTML using Pylons, fetch them with the browser using Ajax, and then simply set the <tt class="docutils literal"><span class="pre">.innerHTML</span></tt> value of the node whose HTML should be changed. This is a technique you’ll see later in this chapter.</p>
</div>
</div>
<div class="section" id="the-event-model">
<h2>The Event Model<a class="headerlink" href="#the-event-model" title="Permalink to this headline">¶</a></h2>
<p id="index-150">The final piece of the JavaScript puzzle to learn about is the event model. As with the language itself and the DOM, Python programmers can usually guess what is going on enough to make their code work but then get very frustrated on the odd occasion when the code they’ve written doesn’t behave in the way they expect.</p>
<p id="index-151">There are two models for event handling in browsers: trickling down and bubbling up. In the <em>trickling-down</em> model, when an event occurs, it is passed to the <tt class="docutils literal"><span class="pre">#document</span></tt> node, and then it works its way down the DOM tree until finally it gets to the node where something happened. In the <em>bubbling-up</em> model, the event is first passed to the node at which something happened and <em>then</em> on to each of the parents in turn until the top of the DOM tree is reached. If you have many child nodes for which something might happen (say a load of images that might change in some way as the mouse moves over them), it would be expensive to add a handler to each image. Instead, using the bubbling-up approach, you could add just the one handler to the parent node of all the images, and it could respond to the event instead.</p>
<p id="index-152">Whether tricking down or bubbling up is the best event model is a somewhat academic discussion because Microsoft supports only bubbling up, so if you want to write portable code, this is the event model you have to use. The differences between the browsers don’t stop there. There are three different ways of adding an event to a node:</p>
<blockquote>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">node[&quot;on&quot;+type]</span> <span class="pre">=</span> <span class="pre">function()</span> <span class="pre">{}</span></tt></li>
<li><tt class="docutils literal"><span class="pre">node.attachEvent(&quot;on&quot;+type,</span> <span class="pre">f);</span></tt></li>
<li><tt class="docutils literal"><span class="pre">node.addEventListener(type,</span> <span class="pre">f,</span> <span class="pre">false);</span></tt></li>
</ul>
</blockquote>
<p>All the browsers support the first method, but only Microsoft supports the second, and the W3C standard suggests the third method. The third method here always takes <tt class="docutils literal"><span class="pre">false</span></tt> as the third argument because this specifies that the handler should use the bubbling-up method, which is what you’d need for cross-browser code.</p>
<p>Unfortunately, the differences don’t end there. In Microsoft browsers, the event itself is accessed as the global <tt class="docutils literal"><span class="pre">event</span></tt> object, whereas in the others it is passed as the first argument to the event handler.</p>
<p id="index-153">Because of these differences, it is highly recommended you use a third-party JavaScript library for event handling because it will abstract away these differences. Here’s a simple example using YUI events to attach a simple <tt class="docutils literal"><span class="pre">onclick</span></tt> handler to an element:</p>
<div class="highlight-python"><pre>var elm = document.getElementById("button-1");
function fnCallback(e) {
    alert("Button 1 was clicked.");
}
YAHOO.util.Event.addListener(elm, "click", fnCallback);</pre>
</div>
<p id="index-154">Once you have written an event handler, you’ve installed it, and it has been fired, you might want to prevent the event from bubbling up to nodes higher up the DOM tree. Again, the way to do this differs across browsers, so it’s best to do it with a framework like YUI. In the YUI case, you’d call <tt class="docutils literal"><span class="pre">YAHOO.util.Event.stopPropogation(e)</span></tt> where <tt class="docutils literal"><span class="pre">e</span></tt> is the event passed to the handler.</p>
<p>Despite that the event is no longer bubbling up, you might also want to prevent the default behavior. For example, clicking a link would navigate the user to a different page, and you might like to prevent this too. You can do so with <tt class="docutils literal"><span class="pre">YAHOO.util.Event.preventDefault(e)</span></tt> where again <tt class="docutils literal"><span class="pre">e</span></tt> is the event passed to the handler. YUI also provides a convenience method <tt class="docutils literal"><span class="pre">YAHOO.util.Event.stopEvent(e)</span></tt>, which stops the bubbling and prevents the default.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last" id="index-155">One point to be aware of is that in Internet Explorer 6 if you remove a DOM node without removing all the event handlers attached to it, a memory leak might occur, so you should always remove event listeners (by setting them to <tt class="docutils literal"><span class="pre">null</span></tt>) before you remove a DOM node so that the garbage collector can clean them up. Better still, use a JavaScript framework to handle this for you.</p>
</div>
<div class="section" id="same-origin-policy">
<h3>Same Origin Policy<a class="headerlink" href="#same-origin-policy" title="Permalink to this headline">¶</a></h3>
<p id="index-156">An important point to be aware of when writing JavaScript code is the same origin policy, which is a security measure implemented by browsers to prevent a document or script loaded from one “origin” from getting or setting properties of a document from a different “origin.” This means a script loaded from Example.com can’t change variables in a script loaded from Example.org. The purpose of this is to prevent one site maliciously reading or modifying data presented to a user from another domain.</p>
<p id="index-157">An <em>origin</em> in this context is a domain name accessed on a particular port with a particular protocol. If any of these is different, most browsers will treat them as different origins except Internet Explorer, which ignores the port and will thus treat two domain names with the same protocol as the same origin regardless of the port.</p>
<p>You can sometimes work around the same origin policy; one method is this: if the two origins you want to be able to communicate with each other are on the same second-level domain, you can change the JavaScript variable <tt class="docutils literal"><span class="pre">document.domain</span></tt> for both documents to that second-level domain. For example, if scripts from some.example.com and other.example.com both set <tt class="docutils literal"><span class="pre">document.domain='example.com'</span></tt>, they will be able to communicate. This works only if the two documents have a common sub-domain.</p>
</div>
<div class="section" id="browser-detection-vs-feature-detection">
<h3>Browser Detection vs. Feature Detection<a class="headerlink" href="#browser-detection-vs-feature-detection" title="Permalink to this headline">¶</a></h3>
<p id="index-158">Because browsers often behave differently, it can be useful to try to work out which browser the user is using to visit a site and to write different JavaScript depending on the browser being used. There is, however, one very serious problem with this approach: browsers lie.</p>
<p>Browser manufacturers have found that lots of old code already exists to try to detect which browser is being used. As a result, when they release new browsers, much of this code wouldn’t work correctly if the browser correctly identified itself because it wasn’t coded for the new browser. As a result, browser manufacturers frequently identify themselves as other browsers. For example, Internet Explorer 7 identifies itself as <tt class="docutils literal"><span class="pre">Mozilla/4.0</span> <span class="pre">(compatible;</span> <span class="pre">MSIE</span> <span class="pre">7.0b;</span> <span class="pre">Windows</span> <span class="pre">NT</span> <span class="pre">6.0)</span></tt>.</p>
<p>A much better approach is to simply test whether a browser has a particular feature you want to use and, if it does, to use it. That way, the code will work for any browser that has the feature, not just ones that pass your browser detection tests.</p>
<p>Of course, by using a JavaScript framework like YUI or JQuery, you isolate yourself from browser differences because they are handled by the framework, so you are less likely to need either browser or feature detection code.</p>
<p id="index-159">Now that you’ve seen how JavaScript works in the browser, let’s return once more to the SimpleSite application and use some YUI JavaScript to spruce up the application.</p>
</div>
</div>
<div class="section" id="adding-animation-to-the-simplesite-flash-message">
<h2>Adding Animation to the SimpleSite Flash Message<a class="headerlink" href="#adding-animation-to-the-simplesite-flash-message" title="Permalink to this headline">¶</a></h2>
<p id="index-160">Although the flash message system you created in Chapter 8 works perfectly well, you can draw the users’ attention to it better by adding some animation. In this section, you’ll learn how to animate the message so that it appears after the page has loaded and fades away after the user clicks it. To achieve this, you’ll need to use YUI’s animation facilities.</p>
<p id="index-161">YUI provides a number of animation classes. You’ll need the following:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">YAHOO.util.Anim</span></tt></dt>
<dd>For animating any numeric attributes of an <tt class="docutils literal"><span class="pre">HTMLElement</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">YAHOO.util.ColorAnim</span></tt></dt>
<dd>For animating attributes related to color</dd>
</dl>
<p>Since the animation appears only on the view pages, you need to add the JavaScript imports to the <tt class="docutils literal"><span class="pre">derived/pages/view.html</span></tt> template. Animation functionality requires both the YUI animation JavaScript file and the combined <tt class="docutils literal"><span class="pre">yahoo-dom-event.js</span></tt> JavaScript file. Add this def at the end of the <tt class="docutils literal"><span class="pre">view.html</span></tt> template:</p>
<div class="highlight-python"><pre>&lt;%def name="js()"&gt;
    &lt;script src="/yui/2.6.0/yahoo-dom-event/yahoo-dom-event.js" type="text/javascript"&gt;&lt;/script&gt;
    &lt;script src="/yui/2.6.0/animation/animation-min.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;/%def&gt;</pre>
</div>
<p>You’ll also need to update <tt class="docutils literal"><span class="pre">base/index.html</span></tt> with a new <tt class="docutils literal"><span class="pre">js()</span></tt> def so that this code gets called. At the top of the template, add line 11:</p>
<div class="highlight-mako"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></td><td class="code"><div class="highlight"><pre><span class="cp">## -*- coding: utf-8 -*-</span><span class="x"></span>

<span class="cp">&lt;%</span><span class="nb">namespace</span> <span class="na">name=</span><span class="s">&quot;navigation&quot;</span> <span class="na">file=</span><span class="s">&quot;/component/navigation.html&quot;</span> <span class="na">import=</span><span class="s">&quot;*&quot;</span> <span class="cp">/&gt;</span><span class="x">\</span>

<span class="x">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;</span>
<span class="x">&quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">    &lt;title&gt;</span><span class="cp">${</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="cp">}</span><span class="x">&lt;/title&gt;</span>
<span class="x">    </span><span class="cp">${</span><span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="cp">}</span><span class="x"></span>
<span class="x">    </span><span class="cp">${</span><span class="bp">self</span><span class="o">.</span><span class="n">js</span><span class="p">()</span><span class="cp">}</span><span class="x"></span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
</pre></div>
</td></tr></table></div>
<p>At the bottom of the template, add this so that child templates that don’t have a <tt class="docutils literal"><span class="pre">js()</span></tt> def will inherit an empty one:</p>
<div class="highlight-python"><pre>&lt;%def name="js()"&gt;&lt;/%def&gt;</pre>
</div>
<p id="index-162">The flash element will start out invisible, so update the styles in <tt class="docutils literal"><span class="pre">public/css/main.css</span></tt> so the <tt class="docutils literal"><span class="pre">#flash</span></tt> style looks like this:</p>
<div class="highlight-python"><pre>#flash {
    background: #ffc;
    padding: 5px;
    border: 1px dotted #000;
    margin-bottom: 20px;
    height: 0px;
    overflow: hidden;   /* so we can animate from zero height */
}</pre>
</div>
<p>Next you need to write the JavaScript function to make the flash message appear. Add this to the bottom of the <tt class="docutils literal"><span class="pre">js()</span></tt> def you just created in the view.html template after the <tt class="docutils literal"><span class="pre">&lt;script&gt;</span></tt> tags:</p>
<div class="highlight-python"><pre>% if session.has_key('flash'):
&lt;script type="text/javascript"&gt;
YAHOO.util.Event.onAvailable(
    'flash',
    function() {
        var a = new YAHOO.util.Anim(
            YAHOO.util.Dom.get('flash'), {
                height: {
                    to: 16
                }
            },
            0.4,
            YAHOO.util.Easing.easeIn
        );
        a.animate();
        YAHOO.util.Event.on('flash', 'click', function() {
                var b = new YAHOO.util.Anim(
                    YAHOO.util.Dom.get('flash'), {
                        opacity: {
                            to: 0
                        },
                    },
                    0.4
                );
                b.onComplete.subscribe(function(){
                    YAHOO.util.Dom.setStyle('flash', 'display', 'none');
                });
                b.animate();
            }
        )
    }
);
&lt;/script&gt;
% endif</pre>
</div>
<p>Notice that you use the <tt class="docutils literal"><span class="pre">onAvailable</span></tt> event that is triggered as soon as the HTML element is available to start the animation as soon as possible. As the animation is running, you also install an event handler to make the flash message gracefully disappear by changing the CSS <tt class="docutils literal"><span class="pre">opacity</span></tt> until it is 0.</p>
<p id="index-163">Now that the code is in place, try editing and saving a page. You should see the yellow flash box appear gradually with its height growing until it reaches its full size. Then, when you click the message, it fades out and disappears. Unfortunately, Internet Explorer doesn’t understand the CSS <tt class="docutils literal"><span class="pre">opacity</span></tt> tag, so the fading out won’t work on Internet Explorer.</p>
</div>
<div class="section" id="ajax">
<h2>Ajax<a class="headerlink" href="#ajax" title="Permalink to this headline">¶</a></h2>
<p id="index-164">By now you should have a good understanding of JavaScript, the DOM, and event handling and have some understanding of how to use YUI. Turn your attention to one of the most useful JavaScript techniques: Ajax.</p>
<p>Ajax is a technique that allows the browser to communicate asynchronously with the server. This means you can fetch data from the browser and use JavaScript to update part of a web page without needing to refresh the page.</p>
<p id="index-165">Using Ajax would be useful in one area of the SimpleSite application in particular: the edit form. At the moment when you edit a page or section, it is possible to enter a value into the <tt class="docutils literal"><span class="pre">before</span></tt> field for a page that isn’t in that section. The FormEncode validation picks up the error, but it would be better if the <tt class="docutils literal"><span class="pre">before</span></tt> field was a drop-down list containing values automatically populated with pages or subsections of the section currently selected in the section drop-down list. Figure 15-4 shows how this would look.</p>
<div class="figure">
<a class="reference external image-reference" href="_images/9349f1504.png"><img alt="Figure 15-4. The Before drop-down list, populated using Ajax" src="_images/9349f1504.png" /></a>
<p class="caption">Figure 15-4. The Before drop-down list, populated using Ajax</p>
</div>
<p id="index-166">This pattern of populating one drop-down list from the values of another using Ajax applies to any situation where you have hierarchical data. First you need to listen for any <tt class="docutils literal"><span class="pre">onchange</span></tt> events from the parent drop-down list. Then you need to contact the server to fetch the HTML for a new <tt class="docutils literal"><span class="pre">before</span></tt> field and replace the old one.</p>
<p>Let’s get started. First you need a function that will return the appropriate values of <tt class="docutils literal"><span class="pre">before</span></tt> for a given section ID. Add this as a static method to <tt class="docutils literal"><span class="pre">model.Nav</span></tt> in <tt class="docutils literal"><span class="pre">model/__init__.py</span></tt>. The <tt class="docutils literal"><span class="pre">exclude</span></tt> option allows you to exclude the current page; after all, it wouldn’t make a lot of sense to have a page or section appear before itself:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Nav</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="c"># ... existing methods</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_before_options</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">nav_q</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Nav</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">nav_q</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">section</span><span class="o">=</span><span class="n">section</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Nav</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">exclude</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">nav</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">nav</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">nav</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>
</pre></div>
</div>
<p>In the page controller’s edit method, set the value of <tt class="docutils literal"><span class="pre">c.before_options</span></tt>, (lines 17-18):</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mf">404</span><span class="p">)</span>
    <span class="n">page_q</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Page</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">page_q</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">page</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mf">404</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">page</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="n">page</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
        <span class="s">&#39;section&#39;</span><span class="p">:</span> <span class="n">page</span><span class="o">.</span><span class="n">section</span><span class="p">,</span>
        <span class="s">&#39;before&#39;</span><span class="p">:</span> <span class="n">page</span><span class="o">.</span><span class="n">before</span><span class="p">,</span>
        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">page</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
        <span class="s">&#39;heading&#39;</span><span class="p">:</span> <span class="n">page</span><span class="o">.</span><span class="n">heading</span><span class="p">,</span>
        <span class="s">&#39;content&#39;</span><span class="p">:</span> <span class="n">page</span><span class="o">.</span><span class="n">content</span>
    <span class="p">}</span>
    <span class="n">c</span><span class="o">.</span><span class="n">before_options</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Nav</span><span class="o">.</span><span class="n">get_before_options</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">before_options</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;[At the end]&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">htmlfill</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;/derived/page/edit.html&#39;</span><span class="p">),</span> <span class="n">values</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p id="index-167">Notice the second line in bold where an extra option is added. This allows a user to specify that the page should be at the end of the section.</p>
<p>You’ll also need to make a similar change to the section controller’s <tt class="docutils literal"><span class="pre">edit()</span></tt> method (lines 14-15):</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mf">404</span><span class="p">)</span>
    <span class="n">section_q</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Section</span><span class="p">)</span>
    <span class="n">section</span> <span class="o">=</span> <span class="n">section_q</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">section</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mf">404</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
        <span class="s">&#39;section&#39;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">section</span><span class="p">,</span>
        <span class="s">&#39;before&#39;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">before</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">c</span><span class="o">.</span><span class="n">before_options</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Nav</span><span class="o">.</span><span class="n">get_before_options</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="n">section</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">before_options</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;[At the end]&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">htmlfill</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;/derived/section/edit.html&#39;</span><span class="p">),</span> <span class="n">values</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Of course, the page and section controller <tt class="docutils literal"><span class="pre">new()</span></tt> actions also require a similar change. Notice that this time the <tt class="docutils literal"><span class="pre">before</span></tt> key isn&#8217;t deleted from the <tt class="docutils literal"><span class="pre">values</span></tt> dictionary, just set to contain an empty string. Update the page controller’s <tt class="docutils literal"><span class="pre">new()</span></tt> action to look like this (lines 5-7 are the updated ones):</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8</pre></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">values</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;before&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s">&#39;before&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">u&#39;None&#39;</span><span class="p">:</span>
        <span class="n">values</span><span class="p">[</span><span class="s">&#39;before&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">c</span><span class="o">.</span><span class="n">before_options</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Nav</span><span class="o">.</span><span class="n">get_before_options</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;section&#39;</span><span class="p">,</span> <span class="mf">0</span><span class="p">))</span>
    <span class="n">c</span><span class="o">.</span><span class="n">before_options</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;[At the end]&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">htmlfill</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;/derived/page/new.html&#39;</span><span class="p">),</span> <span class="n">values</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Update the section controller’s <tt class="docutils literal"><span class="pre">new()</span></tt> action to look like this (again, lines 5-7 are the updated ones):</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8</pre></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">values</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;before&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s">&#39;before&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">u&#39;None&#39;</span><span class="p">:</span>
        <span class="n">values</span><span class="p">[</span><span class="s">&#39;before&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">c</span><span class="o">.</span><span class="n">before_options</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Nav</span><span class="o">.</span><span class="n">get_before_options</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;section&#39;</span><span class="p">,</span> <span class="mf">0</span><span class="p">))</span>
    <span class="n">c</span><span class="o">.</span><span class="n">before_options</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;[At the end]&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">htmlfill</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;/derived/section/new.html&#39;</span><span class="p">),</span> <span class="n">values</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p id="index-168">Now update the <tt class="docutils literal"><span class="pre">derived/nav/fields.html</span></tt> template to replace the existing <tt class="docutils literal"><span class="pre">before</span></tt> field with this:</p>
<div class="highlight-python"><pre>${h.field(
    "Before",
    h.select(
        "before",
        id='before',
        options = c.before_options,
        selected_values=[],
    ),
)}</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">before</span></tt> field now correctly displays the possible options for the section selected when the form is rendered, but you still need to add the JavaScript to detect when the section value changes and trigger the Ajax calls.</p>
<p id="index-169">You’ll write a JavaScript function called <tt class="docutils literal"><span class="pre">callAjax()</span></tt> that takes the URL for the Ajax call as the first argument, the ID of the field containing the value you want to submit as the second, and the name of the element to take the result as the third. Add this to the bottom of the <tt class="docutils literal"><span class="pre">derived/nav/fields.html</span></tt> file:</p>
<div class="highlight-python"><pre>&lt;%def name="js()"&gt;
    &lt;script src="/yui/2.6.0/yahoo-dom-event/yahoo-dom-event.js" type="text/javascript"&gt;&lt;/script&gt;
    &lt;script src="/yui/2.6.0/connection/connection-min.js" type="text/javascript"&gt;&lt;/script&gt;

    &lt;script type="text/javascript"&gt;
    function callAjax(url, field, replace){
        var callback = {
            success: function(o) {
                YAHOO.util.Dom.get(replace).innerHTML = o.responseText;
            },
            failure: function(o) {
                alert("Failed to retrieve required information.");
            }
        }
        url = url +'?selected='+YAHOO.util.Dom.get(field).value;
        var transaction=YAHOO.util.Connect.asyncRequest('GET', url, callback, null);
    }
    &lt;/script&gt;
&lt;/%def&gt;</pre>
</div>
<p id="index-170">Notice that this code relies on the connection JavaScript library being in place before it is parsed. It also requires the yahoo-dom-event library. Sometimes you will need to access objects from the calling function’s scope in the <tt class="docutils literal"><span class="pre">success()</span></tt> and <tt class="docutils literal"><span class="pre">failure()</span></tt> callbacks. You can do this in YUI by specifying an <tt class="docutils literal"><span class="pre">argument</span></tt> list as a member of the earlier <tt class="docutils literal"><span class="pre">callback</span></tt> object, in addition to the <tt class="docutils literal"><span class="pre">success</span></tt> and <tt class="docutils literal"><span class="pre">failure</span></tt> callbacks used in the previous example. The arguments you specify can then be accessed as <tt class="docutils literal"><span class="pre">o.argument</span></tt> in the callback functions. See the YUI Event documentation for an example.</p>
<p>Add an <tt class="docutils literal"><span class="pre">onchange</span></tt> argument to the <tt class="docutils literal"><span class="pre">h.select()</span></tt> helper for the <tt class="docutils literal"><span class="pre">section</span></tt> field in <tt class="docutils literal"><span class="pre">derived/nav/fields.html</span></tt> so it looks like this:</p>
<div class="highlight-python"><pre>${h.field(
    'Section',
    h.select(
        "section",
        id='section',
        selected_values=[],
        options=c.available_sections,
        onchange="callAjax('%s', 'section', 'before'); return false;"%(
            h.url_for(controller="nav", action="before_field_options")
        ),
    ),
    required=True
)}</pre>
</div>
<p id="index-171">This code triggers an Ajax call to the <tt class="docutils literal"><span class="pre">before_field_options()</span></tt> action. If the call is successful, the <tt class="docutils literal"><span class="pre">before</span></tt> field’s options are replaced with the HTML fragment from the Pylons controller; otherwise, a JavaScript alert box displays an error message.</p>
<p>Next you need to add the <tt class="docutils literal"><span class="pre">before_field_options()</span></tt> action to the nav controller to return the new options with the correct values for the section ID sent in the Ajax call. The new action requires the following import:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webhelpers.html.tags</span> <span class="kn">import</span> <span class="n">HTML</span>
</pre></div>
</div>
<p>and looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">before_field_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">Nav</span><span class="o">.</span><span class="n">get_before_options</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">getone</span><span class="p">(</span><span class="s">&#39;selected&#39;</span><span class="p">)):</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HTML</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">id</span><span class="p">))</span>
    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HTML</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s">&#39;[At the end]&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="s">u&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you need to update the <tt class="docutils literal"><span class="pre">edit.html</span></tt> and <tt class="docutils literal"><span class="pre">new.html</span></tt> templates for both the section and the page. Update <tt class="docutils literal"><span class="pre">derived/page/edit.html</span></tt>, <tt class="docutils literal"><span class="pre">derived/section/edit.html</span></tt>, <tt class="docutils literal"><span class="pre">derived/page/new.html</span></tt>, and <tt class="docutils literal"><span class="pre">derived/section/new.html</span></tt> by adding the following import and def at the end of the files:</p>
<div class="highlight-python"><pre>&lt;%namespace file="/derived/nav/fields.html" name="navfields" import="js"/&gt;

&lt;%def name="js()"&gt;
    ${parent.js()}
    ${navfields.js()}
&lt;/%def&gt;</pre>
</div>
<p>This pulls in the <tt class="docutils literal"><span class="pre">js()</span></tt> def from the <tt class="docutils literal"><span class="pre">derived/nav/fields.html</span></tt> file and adds the contents of its <tt class="docutils literal"><span class="pre">head()</span></tt> def.</p>
<p id="index-172">At this point, you are ready to test the updated application. Try to edit a page or section; as you change the section you want the item to appear in, an Ajax call is made, and the correct values of <tt class="docutils literal"><span class="pre">before</span></tt> for that section are set automatically.</p>
<div class="section" id="debugging-ajax-requests">
<h3>Debugging Ajax Requests<a class="headerlink" href="#debugging-ajax-requests" title="Permalink to this headline">¶</a></h3>
<p id="index-173">You can use two tools to debug Ajax requests. The first is the Pylons interactive debugger. If you refer to Chapter 4, you’ll recall that any time an error occurs during a request when Pylons is in debug mode, a header called <tt class="docutils literal"><span class="pre">X-Debug-URL</span></tt> is added to the response containing a URL. The URL is also printed on the console if you are using the <tt class="docutils literal"><span class="pre">paster</span> <span class="pre">serve</span></tt> command to serve the Pylons application. If you visit that URL, you will be able to interactively debug the request that caused the error in the same way you debug normal problems in a Pylons application.</p>
<p id="index-174">On the client side, Firebug is once again the tool of choice. Its console can help you determine any errors that occurred. As an example, the Net tab in Figure 15-5 shows the requests occurring when I edit page 2. The first GET request is to load page 2. The second request is the Ajax request that occurred when I change the <tt class="docutils literal"><span class="pre">section</span></tt> select field. It also shows you how long each request took; this can be very useful in determining how to optimize your Pylons applications, as you’ll see later in the chapter. When you hover your mouse over a request (as I have done on the second request), Firebug shows you the whole request URL. Clicking the + icon shows you the HTTP headers for the request and response, so if an error occurs on an Ajax call, you can also find out the debug URL from the headers displayed by Firebug.</p>
<div class="figure">
<a class="reference external image-reference" href="_images/9349f1505.png"><img alt="Figure 15-5. The Net tab in Firebug showing an Ajax request" src="_images/9349f1505.png" /></a>
<p class="caption">Figure 15-5. The Net tab in Firebug showing an Ajax request</p>
</div>
</div>
<div class="section" id="json">
<h3>JSON<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h3>
<p id="index-175">Although returning HTML from a Pylons controller and using a node’s <tt class="docutils literal"><span class="pre">.innerHTML</span></tt> property to update its content is a perfectly acceptable way of using Ajax, you should be aware of another useful technique.</p>
<p>Instead of taking the approach just described, you could have simply returned the labels and values for the <tt class="docutils literal"><span class="pre">before</span></tt> field from the Pylons controller action and assembled the HTML nodes using DOM manipulation with JavaScript in the browser. If you chose to take this approach, you would have to decide what format you are going to use to send the data in, and the most sensible choice would be a format known as JSON.</p>
<p>JSON stands for JavaScript Object Notation and is quite simply just a string of text written in the same way you would define a JavaScript object using the object literal notation you saw earlier. For example, a JSON data structure representing the <tt class="docutils literal"><span class="pre">before</span></tt> field’s values might look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="n">options</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mf">4</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s">&quot;SVN Page&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mf">5</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s">&quot;Development Page&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s">&quot;[At the end]&quot;</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="index-176">You’ll notice that this looks like the type of data structure you might create in Python, so much so that Pylons provides an <tt class="docutils literal"><span class="pre">&#64;jsonify</span></tt> decorator that you can use on a controller action, which will turn an ordinary Python data structure made up of lists, dictionaries, strings, and numbers into a JSON string.</p>
<p>Add a new action to the nav controller to return a JSON data structure for the <tt class="docutils literal"><span class="pre">before</span></tt> field. You’ll need to import the <tt class="docutils literal"><span class="pre">&#64;jsonify</span></tt> decorator at the top of the file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylons.decorators</span> <span class="kn">import</span> <span class="n">jsonify</span>
</pre></div>
</div>
<p id="index-177">Now add the controller action like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@jsonify</span>
<span class="k">def</span> <span class="nf">before_field_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;options&#39;</span><span class="p">:</span> <span class="p">[</span>
             <span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">Nav</span><span class="o">.</span><span class="n">get_before_options</span><span class="p">(</span>
                 <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">getone</span><span class="p">(</span><span class="s">&#39;selected&#39;</span><span class="p">))</span>
         <span class="p">]</span>
    <span class="p">}</span>
    <span class="n">result</span><span class="p">[</span><span class="s">&#39;options&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="s">u&#39;[At the end]&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="s">u&#39;&#39;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p id="index-178">When the Ajax call is made to this action, the Python dictionary returned is converted to JSON by the <tt class="docutils literal"><span class="pre">&#64;jsonify</span></tt> decorator (which itself uses the simplejson package installed with Pylons), and this is made available in the JavaScript <tt class="docutils literal"><span class="pre">success()</span></tt> callback as <tt class="docutils literal"><span class="pre">o.responseText</span></tt>. Let’s use Firebug to log its value to the console. Update the <tt class="docutils literal"><span class="pre">derived/nav/fields.html</span></tt> file’s <tt class="docutils literal"><span class="pre">js()</span></tt> def so that the <tt class="docutils literal"><span class="pre">callAjax()</span></tt> function looks like this. Line 4 has changed.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></td><td class="code"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">callAjax</span><span class="p">(</span><span class="nx">url</span><span class="o">,</span> <span class="nx">field</span><span class="o">,</span> <span class="nx">replace</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
         <span class="p">}</span><span class="o">,</span>
        <span class="nx">failure</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve required information.&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span> <span class="o">+</span><span class="s1">&#39;?selected=&#39;</span><span class="o">+</span><span class="nx">YAHOO</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">Dom</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">field</span><span class="p">).</span><span class="nx">value</span><span class="o">;</span>
    <span class="kd">var</span> <span class="nx">transaction</span> <span class="o">=</span> <span class="nx">YAHOO</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">Connect</span><span class="p">.</span><span class="nx">asyncRequest</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="o">,</span> <span class="nx">url</span><span class="o">,</span> <span class="nx">callback</span><span class="o">,</span> <span class="kc">null</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p id="index-179">The <tt class="docutils literal"><span class="pre">console</span></tt> object is provided by Firebug so won’t be present on browsers without Firebug. This means using the <tt class="docutils literal"><span class="pre">console</span></tt> object is appropriate only for debugging, and you should always remove all references to it in production code.</p>
<p id="index-180">Also, update the <tt class="docutils literal"><span class="pre">onchange</span></tt> argument for the select field (lines 8-10) so that when its value changes, it calls the new <tt class="docutils literal"><span class="pre">before_field_json()</span></tt> action:</p>
<div class="highlight-mako"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></td><td class="code"><div class="highlight"><pre><span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
    <span class="s">&#39;Section&#39;</span><span class="p">,</span>
    <span class="n">h</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s">&quot;section&quot;</span><span class="p">,</span>
        <span class="nb">id</span><span class="o">=</span><span class="s">&#39;section&#39;</span><span class="p">,</span>
        <span class="n">selected_values</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">options</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">available_sections</span><span class="p">,</span>
        <span class="n">onchange</span><span class="o">=</span><span class="s">&quot;callAjax(&#39;</span><span class="si">%s</span><span class="s">&#39;, &#39;section&#39;, &#39;before&#39;); return false;&quot;</span><span class="o">%</span><span class="p">(</span>
            <span class="n">h</span><span class="o">.</span><span class="n">url_for</span><span class="p">(</span><span class="n">controller</span><span class="o">=</span><span class="s">&quot;nav&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;before_field_json&quot;</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="n">required</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span><span class="cp">}</span><span class="x"></span>
</pre></div>
</td></tr></table></div>
<p>If you edit a page or section, enable Firebug, and change the section field to <tt class="docutils literal"><span class="pre">Home</span> <span class="pre">Section</span></tt>, you should see this in the Firebug console:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;options&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="s">&quot;Contact Us Page&quot;</span><span class="p">,</span> <span class="s">&quot;value&quot;</span><span class="p">:</span> <span class="mf">2</span><span class="p">},</span> <span class="p">{</span><span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="s">&quot;Development Section&quot;</span><span class="p">,</span> <span class="s">&quot;value&quot;</span><span class="p">:</span> <span class="mf">3</span><span class="p">},</span> <span class="p">{</span><span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="s">&quot;Home&quot;</span><span class="p">,</span> <span class="s">&quot;value&quot;</span><span class="p">:</span> <span class="mf">6</span><span class="p">},</span> <span class="p">{</span><span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="s">&quot;[At the end]&quot;</span><span class="p">,</span> <span class="s">&quot;value&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">}]}</span>
</pre></div>
</div>
<p>This is the string the <tt class="docutils literal"><span class="pre">&#64;jsonify</span></tt> decorator returned, but to be useful, it needs to be turned into a JavaScript object. The safest way to do this is with a JSON parser like the one included with YUI, but since JSON is also valid JavaScript source code, you can also use JavaScript’s <tt class="docutils literal"><span class="pre">eval()</span></tt> function to simply evaluate it. As you’ll see later, though, using <tt class="docutils literal"><span class="pre">eval()</span></tt> has some potential security implications.</p>
<p id="index-181">Update the <tt class="docutils literal"><span class="pre">js()</span></tt> def in the <tt class="docutils literal"><span class="pre">derived/nav/fields.html</span></tt> file to look like this:</p>
<div class="highlight-python"><pre>&lt;%def name="js()"&gt;
    &lt;script src="/yui/2.6.0/yahoo-dom-event/yahoo-dom-event.js" type="text/javascript"&gt;&lt;/script&gt;
    &lt;script src="/yui/2.6.0/connection/connection-min.js" type="text/javascript"&gt;&lt;/script&gt;
    &lt;script src="/yui/2.6.0/json/json-min.js" type="text/javascript"&gt;&lt;/script&gt;

    &lt;script type="text/javascript"&gt;
    function callAjax(url, field, replace){
        var callback = {
            success: function(o) {
                var parsed_options = YAHOO.lang.JSON.parse(o.responseText);
                var evaluated_options = eval('('+o.responseText+')');
                console.log(parsed_options);
                console.log(evaluated_options);
             },
            failure: function(o) {
                alert("Failed to retrieve required information.");
            }
        }
        url = url +'?selected='+YAHOO.util.Dom.get(field).value;
        var transaction = YAHOO.util.Connect.asyncRequest('GET', url, callback, null);
    }
    &lt;/script&gt;
&lt;/%def&gt;</pre>
</div>
<p>Once again, the lines that have changed are in bold. If you refresh the page and change the section, you’ll see something like this in the Firebug console:</p>
<div class="highlight-python"><pre>Object id=Contact Us Page value=2
Object id=Contact Us Page value=2</pre>
</div>
<p id="index-182">Both methods produce the same result.</p>
<p>You might be wondering why when evaluating the JSON string with the <tt class="docutils literal"><span class="pre">eval()</span></tt> function you had to add a bracket to the beginning and end of the string. The answer is that it forces JavaScript to unconditionally treat the string as an expression. If you try to call <tt class="docutils literal"><span class="pre">eval()</span></tt> with an empty object string, as in <tt class="docutils literal"><span class="pre">&quot;{}&quot;</span></tt>, it returns <tt class="docutils literal"><span class="pre">undefined</span></tt>, which clearly isn’t what you want. Adding the parentheses fixes the problem. As it happens, array literals such as <tt class="docutils literal"><span class="pre">&quot;[]&quot;</span></tt> work fine even without the parentheses, but it is best to use them. Here’s an example demonstrating these effects:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">js</span><span class="o">&gt;</span> <span class="nb">eval</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">)</span>
<span class="n">js</span><span class="o">&gt;</span> <span class="n">YAHOO</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">isUndefined</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">))</span>
<span class="n">true</span>
<span class="n">js</span><span class="o">&gt;</span> <span class="nb">eval</span><span class="p">(</span><span class="s">&quot;({})&quot;</span><span class="p">)</span>
<span class="n">Object</span>
<span class="n">js</span><span class="o">&gt;</span> <span class="nb">eval</span><span class="p">(</span><span class="s">&quot;[]&quot;</span><span class="p">)</span>
<span class="p">[]</span>
</pre></div>
</div>
<p>The reason you should always use a JSON parser rather than <tt class="docutils literal"><span class="pre">eval()</span></tt> is that you never quite know whether someone might have found a way to compromise your application to get some illegal characters into the JSON your application has generated. For example, imagine that if instead of the JSON it does generate, the <tt class="docutils literal"><span class="pre">before_field_json()</span></tt> action returned <tt class="docutils literal"><span class="pre">&quot;{options:</span> <span class="pre">alert(document.cookies)}&quot;</span></tt>. With the <tt class="docutils literal"><span class="pre">eval('('+o.responseText+')')</span></tt> technique, the <tt class="docutils literal"><span class="pre">alert()</span></tt> function gets called, and any cookies the application uses appear in an alert window. Now imagine that rather than calling <tt class="docutils literal"><span class="pre">alert()</span></tt>, a hacker calls a different function. They could potentially get hold of your user’s cookies and set up their own browsers with their cookies. The Pylons application would think that the hacker was actually the real user. Of course, lots of other exploits are possible, but the point is that if a hacker can compromise your JSON, an attack is possible.</p>
<div class="highlight-python"><pre>js&gt; eval("({options: alert(document.cookies)})")
[The alert window is displayed]</pre>
</div>
<p id="index-183">On the other hand, if you use a JSON parser, the JSON will not pass as valid, and a simple JavaScript error will be raised without doing any damage except causing the code that updates the before field not to be called.</p>
<div class="highlight-python"><pre>js&gt; YAHOO.lang.JSON.parse("{options: alert(document.cookies)}")
SyntaxError: parseJSON</pre>
</div>
<p>For this reason, you should <em>always</em> use a JSON parser, just to be safe. With this firmly established, let’s remove the lines that refer to the Firebug <tt class="docutils literal"><span class="pre">console</span></tt> object and finish updating the <tt class="docutils literal"><span class="pre">js()</span></tt> def in the <tt class="docutils literal"><span class="pre">derived/nav/fields.html</span></tt> file so that it looks like this:</p>
<div class="highlight-python"><pre>&lt;%def name="js()"&gt;
    &lt;script src="/yui/2.6.0/yahoo-dom-event/yahoo-dom-event.js" type="text/javascript"&gt;&lt;/script&gt;
    &lt;script src="/yui/2.6.0/connection/connection-min.js" type="text/javascript"&gt;&lt;/script&gt;
    &lt;script src="/yui/2.6.0/json/json-min.js" type="text/javascript"&gt;&lt;/script&gt;

    &lt;script type="text/javascript"&gt;
    function callAjax(url, field, replace){
        var callback = {
            success: function(o) {
                var parsed_options = YAHOO.lang.JSON.parse(o.responseText);
                var before = document.getElementById(replace);
                // Remove current options
                while(before.hasChildNodes() === true)
                {
                    before.removeChild(before.childNodes[0]);
                }
                // Add new options
                for (var i=0; i&lt;parsed_options.options.length; i++) {
                    var new_option = document.createElement('option');
                    new_option.text = parsed_options.options[i].id;
                    new_option.value =  parsed_options.options[i].value;
                    before.appendChild(new_option);
                }
            },
            failure: function(o) {
                alert("Failed to retrieve required information.");
            }
        }
        url = url +'?selected='+YAHOO.util.Dom.get(field).value;
        var transaction = YAHOO.util.Connect.asyncRequest('GET', url, callback, null);
    }
    &lt;/script&gt;
&lt;/%def&gt;</pre>
</div>
<p id="index-184">If you test the example, you should find it works exactly as it did when you used the <tt class="docutils literal"><span class="pre">.innerHTML</span></tt> technique instead. Which technique you choose to use in your own applications is up to you.</p>
</div>
</div>
<div class="section" id="reducing-page-load-time">
<h2>Reducing Page Load Time<a class="headerlink" href="#reducing-page-load-time" title="Permalink to this headline">¶</a></h2>
<p id="index-185">If you are including a large number of CSS or JavaScript files in your pages, the length of time it takes to load a page can begin to become significant. The vast majority of the time it isn’t the speed of your Pylons application that affects how fast your application appears to your users. Much more important usually is the speed with which the browser can pull in and process all the files that will need to be loaded and rendered to display the finished web page.</p>
<p>You can generally reduce page load times fairly easily in the following ways:</p>
<dl class="docutils">
<dt><em>Compressing text files</em></dt>
<dd>Transmitting less data takes less time. In Chapter 16, I’ll show how you can write some middleware to compress text data automatically.</dd>
<dt><em>Concatenating text files</em></dt>
<dd>An overhead is involved in each HTTP request made, so the fewer requests the browser makes, the better.</dd>
<dt><em>Putting multiple icons or image fragments in a single image</em></dt>
<dd>You can then use the same image lots of times throughout the page and use CSS to choose which part of the image you display in each place. Again, the fewer images you have to fetch, the fewer HTTP requests are needed, and the faster the page should load.</dd>
<dt><em>Cache data</em></dt>
<dd>If the browser can fetch a file from its cache, it doesn’t have to fetch it from the network, so that will be faster. Pylons automatically supports E-Tag caching for the static files it serves, which means that browsers should fetch a new copy only if the E-Tag changes. This can speed things up a little, but since the browser has to make a request to see whether the E-Tag has changed, this isn’t as effective for small files as it is for large ones.</dd>
</dl>
<p>Some other less obvious things can affect page load time too:</p>
<dl class="docutils">
<dt><em>Number of DNS queries</em></dt>
<dd>The more different domains (or subdomains) that your page loads information from, the more DNS lookups the browser will have to do to discover the IP addresses associated with those domains. Depending on the number of name servers involved, it can take up to a second or more for each DNS lookup. Of course, the browser will cache the DNS information, but it is worth remembering that the first page load will be quicker if all the resources are served from the same domain. This is particularly worth remembering for applications using Routes’ subdomain feature because you probably wouldn’t want to serve static resources from lots of different subdomains if you could serve them all from the same domain.</dd>
</dl>
<dl class="docutils" id="index-186">
<dt><em>Minimizing JavaScript</em></dt>
<dd>Writing JavaScript usually involves adding quite a lot of whitespace. If you use a JavaScript minification tool, it can strip whitespace and comments and also rename local variables to ones that use fewer characters. Again, fewer characters means faster transfer time. One JavaScript minifier is the YUI compressor written in Java and available from <a class="reference external" href="http://developer.yahoo.com/yui/compressor/">http://developer.yahoo.com/yui/compressor/</a>.</dd>
<dt><em>Positioning of CSS and JavaScript within HTML</em></dt>
<dd>CSS files should be included with the <tt class="docutils literal"><span class="pre">&lt;link&gt;</span></tt> tag as close to the top of the <tt class="docutils literal"><span class="pre">&lt;head&gt;</span></tt> as possible. This gives browsers all the information they need about the styles as early as possible, which in turn means they can start rendering the page sooner. By contrast, JavaScript <tt class="docutils literal"><span class="pre">&lt;script&gt;</span></tt> tags should go as close to the bottom of the <tt class="docutils literal"><span class="pre">&lt;body&gt;</span></tt> as possible because browsers typically won’t start downloading other resources like images while script downloads are in place, so it makes sense to have them later.</dd>
</dl>
<p id="index-187">Knowing which of these problems is affecting your site the most is very tricky without a detailed analysis of how long each component takes to load. Luckily, there are tools to help with this. As you saw earlier in the chapter, Firebug’s Net tab displays the time taken for each request as well as the overall page load time, so this will give you a good indication of where files are being requested more than they need to be. If you need detailed information to optimize page load performance, you should download another Firefox plug-in called YSlow which can give you a detailed performance analysis. YSlow relies on Firebug for some of its functionality. You can get YSlow from <a class="reference external" href="http://developer.yahoo.com/yslow/">http://developer.yahoo.com/yslow/</a>, and if you plan on using it, the help page at <a class="reference external" href="http://developer.yahoo.com/yslow/help/">http://developer.yahoo.com/yslow/help/</a> is very useful.</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Once again, I covered a lot in this chapter, from CSS grids to prototypal inheritance, DOM manipulation, events, and Ajax. The appropriate use of CSS, JavaScript, and Ajax can really improve your application and allow you to build interfaces that aren’t possible with traditional static HTML.</p>
<p>There is plenty more in the YUI library, and I strongly encourage you to investigate it. I hope that the discussion in this chapter goes some way toward giving you the knowledge you’ll need to begin reading the YUI documentation in earnest. As well as good documentation and plenty of examples, there are also some very handy A4 cheat sheets for each component. Visit <a class="reference external" href="http://developer.yahoo.com/yui">http://developer.yahoo.com/yui</a> for more information, but don’t forget that Pylons works equally well with other frameworks like JQuery.</p>
<p id="index-188">That’s all for Part 2 of the book. In Part 3, you’ll begin looking at expert Pylons topics starting with a discussion of the Web Server Gateway Interface, which is at the core of Pylons’ architecture.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Chapter 15: CSS, JavaScript, and Ajax</a><ul>
<li><a class="reference external" href="#adding-yui-to-your-project">Adding YUI to Your Project</a></li>
<li><a class="reference external" href="#resetting-the-browser-css">Resetting the Browser CSS</a></li>
<li><a class="reference external" href="#fonts">Fonts</a></li>
<li><a class="reference external" href="#grids">Grids</a><ul>
<li><a class="reference external" href="#template-preset-grids">Template Preset Grids</a></li>
<li><a class="reference external" href="#nested-grids">Nested Grids</a></li>
<li><a class="reference external" href="#special-nested-grids">Special Nested Grids</a></li>
</ul>
</li>
<li><a class="reference external" href="#updating-simplesite-to-use-css-grids">Updating SimpleSite to Use CSS Grids</a></li>
<li><a class="reference external" href="#introducing-firebug">Introducing Firebug</a></li>
<li><a class="reference external" href="#introducing-javascript">Introducing JavaScript</a></li>
<li><a class="reference external" href="#javascript-essentials">JavaScript Essentials</a><ul>
<li><a class="reference external" href="#operators-of-interest">Operators of Interest</a></li>
<li><a class="reference external" href="#types">Types</a></li>
<li><a class="reference external" href="#functions">Functions</a></li>
<li><a class="reference external" href="#function-scope-and-closures">Function Scope and Closures</a></li>
<li><a class="reference external" href="#objects">Objects</a></li>
<li><a class="reference external" href="#this">this</a></li>
<li><a class="reference external" href="#namespaces">Namespaces</a></li>
<li><a class="reference external" href="#inheritance">Inheritance</a></li>
<li><a class="reference external" href="#prototypes">Prototypes</a></li>
<li><a class="reference external" href="#javascript-in-html">JavaScript in HTML</a></li>
</ul>
</li>
<li><a class="reference external" href="#the-document-object-model">The Document Object Model</a><ul>
<li><a class="reference external" href="#navigating-the-dom">Navigating the DOM</a></li>
<li><a class="reference external" href="#manipulating-the-dom">Manipulating the DOM</a></li>
</ul>
</li>
<li><a class="reference external" href="#the-event-model">The Event Model</a><ul>
<li><a class="reference external" href="#same-origin-policy">Same Origin Policy</a></li>
<li><a class="reference external" href="#browser-detection-vs-feature-detection">Browser Detection vs. Feature Detection</a></li>
</ul>
</li>
<li><a class="reference external" href="#adding-animation-to-the-simplesite-flash-message">Adding Animation to the SimpleSite Flash Message</a></li>
<li><a class="reference external" href="#ajax">Ajax</a><ul>
<li><a class="reference external" href="#debugging-ajax-requests">Debugging Ajax Requests</a></li>
<li><a class="reference external" href="#json">JSON</a></li>
</ul>
</li>
<li><a class="reference external" href="#reducing-page-load-time">Reducing Page Load Time</a></li>
<li><a class="reference external" href="#summary">Summary</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="simplesite-tutorial-part-2.html"
                                  title="previous chapter">Chapter 14: SimpleSite Tutorial Part 2</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="the-web-server-gateway-interface-wsgi.html"
                                  title="next chapter">Chapter 16: The Web Server Gateway Interface (WSGI)</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/css-javascript-and-ajax.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="http://pylonsbook.com/en/1.0/search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="the-web-server-gateway-interface-wsgi.html" title="Chapter 16: The Web Server Gateway Interface (WSGI)"
             >next</a> |</li>
        <li class="right" >
          <a href="simplesite-tutorial-part-2.html" title="Chapter 14: SimpleSite Tutorial Part 2"
             >previous</a> |</li>
        <li><a href="index.html">Pylons Book v1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009, James Gardner.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.1.
    </div>
  </body>

<!-- Mirrored from pylonsbook.com/en/1.0/css-javascript-and-ajax.html by HTTrack Website Copier/3.x [XR&CO'2008], Thu, 11 Jun 2009 15:43:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>